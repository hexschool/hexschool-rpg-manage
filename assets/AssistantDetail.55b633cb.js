import{l as us,N as hs,r as c,s as q,m as I,o as _s,z as O,a as n,c as d,b as s,A as Z,f as vs,h as _,g as U,F as v,q as p,w as G,C as D,x as b,D as ps,E as bs,Z as ms}from"./index.b171e68b.js";/* empty css                   */import{b as gs}from"./bsTab.22ff94d2.js";import{a as ks}from"./assistant.dd4561b8.js";import{a as fs}from"./task.face143e.js";import"./tab.ac64535a.js";const ys={class:"about px-4 mt-4"},ws={class:"border-bottom border-light pb-2 mb-4"},Ls={"aria-label":"breadcrumb"},Ts={class:"breadcrumb"},xs={class:"breadcrumb-item"},Cs=s("li",{class:"breadcrumb-item active","aria-current":"page"},"\u7DE8\u8F2F\u52A9\u6559",-1),$s=s("h1",{class:"fs-4 mb-0"},"\u7DE8\u8F2F\u52A9\u6559",-1),As={id:"assistantDetail",class:"col-md-5"},Gs={class:"assistant card shadow-sm rounded-4 overflow-hidden mb-4"},Ds={class:"card-header bg-white py-3"},Vs={key:1,style:{width:"60px",height:"60px"},class:"rounded-circle mx-auto bg-light mb-1"},Es={class:"text-center mb-0"},Ss={class:"card-body"},Ns={class:"d-flex align-items-center"},Us=s("span",{class:"material-icons-outlined me-1"},"email",-1),Ms={class:"d-flex"},Ps=s("span",{class:"material-icons-outlined me-1"},"face",-1),zs={class:"col-md-12"},Bs={class:"nav nav-tabs",role:"tablist"},js=["id","aria-controls","data-bs-target","onClick"],Fs={class:"tab-content mb-5",id:"myTabContent"},Rs={class:"tab-pane fade show active",id:"assistantTab",role:"tabpanel","aria-labelledby":"assistant-tab"},qs={class:"mt-4 card shadow-sm rounded-4 overflow-hidden mb-4"},Is=s("div",{class:"card-header bg-white py-3"},[s("h2",{class:"fs-6 mb-0 lh-base"},"\u52A9\u6559\u7A31\u865F")],-1),Os={class:"card-body card-body-height"},Zs={class:"list list-unstyled"},Hs={class:"form-check"},Js=["id","value","checked"],Ks=["for"],Qs=s("hr",null,null,-1),Ws={class:"card-footer bg-white text-end py-3"},Xs={class:"tab-pane fade",id:"coursesTab",role:"tabpanel","aria-labelledby":"courses-tab"},Ys={class:"mt-4 row position-relative align-items-start"},st={class:"col-md-4 users-sticky-md-top",style:{top:"80px"}},tt={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},et=s("div",{class:"card-header bg-white py-3"},[s("h2",{class:"fs-6 mb-0 lh-base"},"\u53EF\u6279\u6539\u7684\u4F5C\u696D\u5217\u8868")],-1),at={class:"card-body card-body-height"},ot={class:"list list-unstyled"},it=s("hr",null,null,-1),lt={class:"col-md-8"},nt={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},dt={class:"card-header bg-white py-3"},ct={class:"form-check"},rt=s("label",{class:"h2 fs-6 mb-0 lh-base",for:"assistantAll"},"\u6279\u6539\u8AB2\u7A0B\u8A2D\u5B9A",-1),ut={class:"card-body card-body-height"},ht={class:"list list-unstyled"},_t={class:"form-check"},vt=["id","value","checked"],pt=["for"],bt=s("hr",null,null,-1),mt={class:"card-footer bg-white text-end py-3"},gt={class:"tab-pane fade",id:"tasksTab",role:"tabpanel","aria-labelledby":"tasks-tab"},kt={class:"mt-4 row position-relative align-items-start"},ft={class:"col-md-4 users-sticky-md-top",style:{top:"80px"}},yt={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},wt=s("div",{class:"card-header bg-white py-3"},[s("h2",{class:"fs-6 mb-0 lh-base"},"\u53EF\u6279\u6539\u7684\u4EFB\u52D9\u5217\u8868")],-1),Lt={class:"card-body card-body-height"},Tt={class:"list-unstyled mb-0"},xt=["aria-controls","href"],Ct={class:"fw-bold"},$t=["id"],At={class:"list list-unstyled"},Gt={class:"col-md-8"},Dt={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},Vt=s("div",{class:"card-header bg-white py-3 fw-bold"}," \u6279\u6539\u4EFB\u52D9\u8A2D\u5B9A ",-1),Et={class:"card-body card-body-height"},St={class:"list list-unstyled mt-3"},Nt={class:"form-check"},Ut=["id","value"],Mt=["for"],Pt=s("hr",null,null,-1),zt={class:"card-footer bg-white text-end py-3"},Ht={__name:"AssistantDetail",setup(Bt){const{apiGetVideoCoursesList:H,apiGetAssistantDetail:J,apiPutAssistantDetail:K,apiGetAssistantsTitles:Q,apiPutAssistantTasks:W,apiDeleteAssistantTasks:X}=ks,{apiGetTaskGroupsList:Y,apiGetTasks:ss}=fs,ts=us(),m=hs.useLoading(),V=(a,e,l)=>a.map(r=>(r[e]=l,r)),k=c([]),u=c([]),h=c([]),w=c(!1),es=()=>{w.value?(h.value=[],k.value.forEach(a=>{h.value.push(a.id)})):h.value=[]};q(()=>h.value,()=>{k.value.length!==0&&h.value.length===k.value.length?w.value=!0:w.value=!1},{deep:!0});const as=()=>{k.value.forEach(a=>{u.value.video_courses.forEach(e=>{a.id===e.id&&(a.isChecked=!0,h.value.push(a.id))})})},os=async()=>{const a=m.show();try{h.value=[];const{courses:e}=await H();k.value=V(e,"isChecked",!1),as()}catch(e){b("danger","\u53D6\u5F97\u8AB2\u7A0B\u5217\u8868\u5931\u6557",`${e.response.data.statusCode}:${e.response.data.message}`)}finally{a.hide()}},E=c([]),L=c([]),is=()=>{E.value.forEach(a=>{u.value.assistant_titles.forEach(e=>{a.id===e.id&&(a.isChecked=!0,L.value.push(a.id))})})},ls=async()=>{const a=m.show();try{L.value=[];const{assistant_titles:e}=await Q();E.value=V(e,"isChecked",!1),is()}catch(e){b("danger","\u53D6\u5F97\u52A9\u6559\u7A31\u865F\u5931\u6557",`${e.response.data.statusCode}:${e.response.data.message}`)}finally{a.hide()}},f=c(""),S=c([]),T=c({taskGroupsList:[],pagination:{total:100,count:10,total_page:10,current_page:1}}),C=c(1),ns=async(a=1)=>{var l,r,t,i;const e=m.show();try{const{task_groups:o,pagination:g}=await Y({count:150,page:a});T.value.taskGroupsList=o,T.value.pagination=g,C.value=g.current_page,S.value=[...S.value,...T.value.taskGroupsList]}catch(o){b("danger","\u53D6\u5F97\u4EFB\u52D9\u7FA4\u7D44\u5217\u8868\u5931\u6557",`${(r=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:r.statusCode} : ${(i=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:i.message}`)}finally{e.hide()}},M=async(a=1)=>{await ns(a),T.value.pagination.total_page!==0&&C.value!==T.value.pagination.total_page&&(C.value+=1,M(C.value))},$=c([]),x=c({tasksList:[],pagination:{total:100,count:10,total_page:10,current_page:1}}),A=c(1),P=c(null),ds=async(a=1)=>{var l,r,t,i;const e=m.show();try{const{tasks:o,pagination:g}=await ss({count:100,page:a,scoped:P.value});x.value.tasksList=V(o,"isChecked",!1),x.value.tasksList=o,x.value.pagination=g,A.value=g.current_page,$.value=[...$.value,...o]}catch(o){b("danger","\u53D6\u5F97\u6307\u5B9A\u7684\u4EFB\u52D9\u7FA4\u7D44\u4EFB\u52D9\u5217\u8868\u5931\u6557",`${(r=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:r.statusCode} : ${(i=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:i.message}`)}finally{e.hide()}},z=c(""),y=c([]),N=async a=>{var l,r;const e=m.show();try{const t=await J(a);u.value=t,y.value=[],t.task_groups.forEach(i=>{i.tasks&&i.tasks.forEach(o=>{y.value.push({id:o.id,task_group_id:i.id})})}),os(),ls()}catch(t){b("danger","\u53D6\u5F97\u52A9\u6559\u8CC7\u8A0A\u5931\u6557",`${(l=t.response)==null?void 0:l.data.statusCode}:${(r=t.response)==null?void 0:r.data.message}`)}finally{e.hide()}},B=async(a=1)=>{await ds(a),x.value.pagination.total_page!==0&&A.value!==x.value.pagination.total_page&&(A.value+=1,B(A.value))},cs=async a=>{z.value=a,P.value=`&filter=task_group&task_group_id=${z.value}`,$.value=[],await B()},j=async a=>{const e=m.show();try{const l={video_course_list:h.value,assistant_title_list:L.value};await K(a,l),b("success","\u66F4\u65B0\u6210\u529F","\u5DF2\u6210\u529F\u7DE8\u8F2F\u52A9\u6559\u8A2D\u5B9A"),N(a)}catch(l){b("danger","\u66F4\u65B0\u52A9\u6559\u8CC7\u8A0A\u5931\u6557",`${l.response.data.statusCode}:${l.response.data.message}`)}finally{e.hide()}},rs=async a=>{const e=m.show();try{let l=[];y.value.length>0?(l=y.value.reduce((t,i)=>{let o=t.find(g=>g.task_group_id===i.task_group_id);return o||(o={id:i.task_group_id,task_ids:[]},t.push(o)),o.task_ids.push(i.id),t},[]),await W(a,{task_groups:l})):await X(a),N(a)}catch(l){b("danger","\u66F4\u65B0\u52A9\u6559\u53EF\u6279\u6539\u4EFB\u52D9\u8A2D\u5B9A\u5931\u6557",`${l.response.data.statusCode}:${l.response.data.message}`)}finally{e.hide()}},F=I([]),R=I([{id:"assistant-tab",name:"\u52A9\u6559\u7A31\u865F\u8A2D\u5B9A",target:"assistantTab",active:!0,danger:!1,element:null},{id:"courses-tab",name:"\u6279\u6539\u8AB2\u7A0B\u8A2D\u5B9A",target:"coursesTab",active:!1,danger:!1,element:null},{id:"tasks-tab",name:"\u6279\u6539\u4EFB\u52D9\u8A2D\u5B9A",target:"tasksTab",active:!1,danger:!1,element:null}]);return _s(()=>{const a=ts.params.id;N(a),M(),gs(F,R)}),q(()=>f.value,()=>{f.value&&cs(f.value)}),(a,e)=>{const l=O("router-link"),r=O("v-select");return n(),d("div",ys,[s("header",ws,[s("nav",Ls,[s("ol",Ts,[s("li",xs,[Z(l,{to:"/admin/assistants/list"},{default:vs(()=>[U(" \u52A9\u6559\u7BA1\u7406 ")]),_:1})]),Cs])]),$s]),s("div",As,[s("div",Gs,[s("div",Ds,[(n(),d("div",Vs)),s("h5",Es,_(u.value.nickname),1)]),s("div",Ss,[s("p",Ns,[Us,U(" "+_(u.value.email),1)]),s("div",Ms,[Ps,s("div",null,[(n(!0),d(v,null,p(u.value.assistant_titles,t=>(n(),d("span",{key:t.id,class:"badge bg-light text-dark me-1"},_(t.name),1))),128))])])])])]),s("div",zs,[s("ul",Bs,[(n(!0),d(v,null,p(R,t=>(n(),d("li",{class:"nav-item",role:"presentation",key:t.id},[s("button",{class:ps(["nav-link border",{active:t.active,"text-danger bg-danger bg-opacity-10":t.danger}]),id:t.id,type:"button",role:"tab","aria-controls":t.id,"aria-selected":"true","data-bs-target":`#${t.target}`,ref_for:!0,ref:i=>F.push(i),onClick:bs(i=>t.element.show(),["prevent"])},_(t.name),11,js)]))),128))])]),s("div",Fs,[s("div",Rs,[s("div",qs,[Is,s("div",Os,[s("ul",Zs,[(n(!0),d(v,null,p(E.value,t=>(n(),d("li",{key:t.id,class:"list-item"},[s("div",Hs,[G(s("input",{id:t.name,"onUpdate:modelValue":e[0]||(e[0]=i=>L.value=i),class:"form-check-input",type:"checkbox",value:t.id,checked:t.isChecked},null,8,Js),[[D,L.value]]),s("span",{class:"d-inline-block rounded-pill me-1",style:ms([{width:"10px",height:"10px"},`background-color:${t.color_code}`])},null,4),s("label",{class:"form-check-label",for:t.name},_(t.name),9,Ks)]),Qs]))),128))])]),s("div",Ws,[s("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=t=>j(u.value.user_id))}," \u66F4\u65B0 ")])])]),s("div",Xs,[s("div",Ys,[s("div",st,[s("div",tt,[et,s("div",at,[s("ul",ot,[(n(!0),d(v,null,p(u.value.video_courses,t=>(n(),d("li",{key:t.id,class:"list-item"},[U(_(t.name)+" ",1),it]))),128))])])])]),s("div",lt,[s("div",nt,[s("div",dt,[s("div",ct,[G(s("input",{id:"assistantAll","onUpdate:modelValue":e[2]||(e[2]=t=>w.value=t),class:"form-check-input",type:"checkbox",onChange:es},null,544),[[D,w.value]]),rt])]),s("div",ut,[s("ul",ht,[(n(!0),d(v,null,p(k.value,t=>(n(),d("li",{key:t.id,class:"list-item"},[s("div",_t,[G(s("input",{id:t.id,"onUpdate:modelValue":e[3]||(e[3]=i=>h.value=i),class:"form-check-input",type:"checkbox",value:t.id,checked:t.isChecked},null,8,vt),[[D,h.value]]),s("label",{class:"form-check-label",for:t.id},_(t.name),9,pt)]),bt]))),128))])]),s("div",mt,[s("button",{type:"button",class:"btn btn-primary",onClick:e[4]||(e[4]=t=>j(u.value.user_id))}," \u66F4\u65B0 ")])])])])]),s("div",gt,[s("div",kt,[s("div",ft,[s("div",yt,[wt,s("div",Lt,[s("ul",Tt,[(n(!0),d(v,null,p(u.value.task_groups,t=>(n(),d("li",{key:t.id,class:"mb-2"},[s("a",{class:"d-flex justify-content-between align-items-center text-decoration-none bg-light text-primary rounded mb-1 px-2 py-1","data-bs-toggle":"collapse",role:"button","aria-expanded":"false","aria-controls":t.id,href:`#checkedTaskList-${t.id}`},[s("span",Ct,_(t.name),1)],8,xt),s("div",{class:"collapse",id:`checkedTaskList-${t.id}`},[s("ul",At,[(n(!0),d(v,null,p(t.tasks,i=>(n(),d("li",{key:i.id,class:"list-item px-1 mb-1"},_(i.name),1))),128))])],8,$t)]))),128))])])])]),s("div",Gt,[s("div",Dt,[Vt,s("div",Et,[Z(r,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=t=>f.value=t),options:S.value,label:"name",clearable:!1,reduce:t=>t.id},null,8,["modelValue","options","reduce"]),s("ul",St,[(n(!0),d(v,null,p($.value,t=>(n(),d("li",{class:"list-item",key:t.id},[s("div",Nt,[G(s("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=i=>y.value=i),id:t.id,value:{task_group_id:f.value,id:t.id}},null,8,Ut),[[D,y.value]]),s("label",{class:"form-check-label",for:t.id},_(t.name),9,Mt)]),Pt]))),128))])]),s("div",zt,[s("button",{type:"button",class:"btn btn-primary",onClick:e[7]||(e[7]=t=>rs(u.value.user_id))}," \u66F4\u65B0\u4EFB\u52D9 ")])])])])])])])}}};export{Ht as default};
