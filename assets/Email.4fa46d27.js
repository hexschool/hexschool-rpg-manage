import{n as D,a as d,c,b as e,h,i as a,F as x,q as $,w as v,v as y,Q as M,r as m,o as k,A as L,d as g,x as _,L as T,D as j,E as U}from"./index.b171e68b.js";const C={class:"card shadow-sm rounded-4 overflow-hidden mb-4 position-relative"},A={class:"card-body"},B={class:"card-title mb-3"},I={class:"mb-3 border-bottom"},P=e("h6",null,"\u89F8\u767C\u689D\u4EF6",-1),S={class:"mb-3 border-bottom"},z=e("h6",null,"\u53EF\u7528\u6B04\u4F4D",-1),F={class:"table table-borderless"},H=e("thead",null,[e("tr",null,[e("th",{width:"100"}," \u6B04\u4F4D\u540D\u7A31 "),e("th",{width:"200"}," \u8B8A\u6578 "),e("th",null,"\u6E2C\u8A66\u5C08\u7528\u6E2C\u8A66\u6587\u5B57")])],-1),N=["id","onUpdate:modelValue"],q={class:"row"},O={class:"col-md-6"},Q={class:"mb-3"},R=e("label",{for:"mail_to",class:"form-label"},"\u767C\u9001\u4FE1\u7BB1",-1),G={class:"mb-3"},J=e("label",{for:"mail_title",class:"form-label"},"\u4FE1\u4EF6\u6A19\u984C",-1),K={class:"mb-3"},W=e("label",{for:"mail_time",class:"form-label"},"\u767C\u9001\u9031\u671F",-1),X=["value"],Y={class:"mb-3"},Z=e("label",{for:"mail_content",class:"form-label"},"\u8A0A\u606F\u5167\u5BB9",-1),ee=e("br",null,null,-1),te=["innerHTML"],se={class:"d-flex justify-content-between mt-5"},le={__name:"Email",props:{data:{type:Object,default:()=>({})},schedulesList:{type:Array,default:()=>[]}},emits:["emailTest","editEmail"],setup(w,{emit:i}){const E=w,{data:l}=D(E),f=(r,s)=>{const t=[];s.forEach(u=>{t.push({id:u.id,content:u.replace_keyword})}),i("emailTest",r,t)},p=(r,s)=>{const t={cht_name:s.cht_name,content:s.content,subject:s.subject,schedule_id:s.schedule_id};i("editEmail",r,t)};return(r,s)=>(d(),c("div",C,[e("div",A,[e("h4",B,h(a(l).cht_name)+"\u56DE\u994B ",1),e("div",I,[P,e("p",null,h(a(l).trigger_description),1)]),e("div",S,[z,e("table",F,[H,e("tbody",null,[(d(!0),c(x,null,$(a(l).variables,t=>(d(),c("tr",{key:`email_${t.id}`},[e("td",null,h(t.cht_name),1),e("td",null,"{% "+h(t.name)+" %}",1),e("td",null,[v(e("input",{id:t.name,"onUpdate:modelValue":u=>t.replace_keyword=u,type:"text",class:"form-control"},null,8,N),[[y,t.replace_keyword]])])]))),128))])])]),e("div",q,[e("div",O,[e("div",Q,[R,v(e("input",{id:"mail_to","onUpdate:modelValue":s[0]||(s[0]=t=>a(l).sender_mail=t),disabled:"",type:"text",class:"form-control",placeholder:"no-reply@hexschool.com"},null,512),[[y,a(l).sender_mail]])]),e("div",G,[J,v(e("input",{id:"mail_title","onUpdate:modelValue":s[1]||(s[1]=t=>a(l).subject=t),type:"text",class:"form-control",placeholder:"\u4F5C\u696D\u88AB\u6279\u6539"},null,512),[[y,a(l).subject]])]),e("div",K,[W,v(e("select",{id:"mail_time","onUpdate:modelValue":s[2]||(s[2]=t=>a(l).schedule_id=t),class:"form-select","aria-label":"Default select example"},[(d(!0),c(x,null,$(w.schedulesList,t=>(d(),c("option",{key:`schedule_${t.id}`,value:t.id},h(t.cht_name),9,X))),128))],512),[[M,a(l).schedule_id]])])])]),e("div",Y,[Z,v(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=t=>a(l).content=t),class:"form-control",rows:"20"},null,512),[[y,a(l).content]]),ee,e("div",{innerHTML:a(l).content},null,8,te)]),e("div",se,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:s[4]||(s[4]=t=>f(a(l).id,a(l).variables,a(l).content))}," \u6E2C\u8A66\u767C\u9001 "),e("button",{type:"button",class:"btn btn-secondary",onClick:s[5]||(s[5]=t=>p(a(l).id,a(l)))}," \u78BA\u8A8D\u66F4\u65B0 ")])])]))}},ae={class:"px-4 mt-4"},oe=e("h4",{class:"mb-3"}," Email \u8A0A\u606F\u7BA1\u7406 ",-1),ne={class:"row"},ie={class:"col-md-3"},de={class:"list-group"},ce=["onClick"],re={class:"col-md-9"},_e={__name:"Email",setup(w){const i=m(!1),E=m(!0),l=m(1),f=m(null),p=m({}),r=async()=>{try{i.value=!0;const o=await g.get("/v1/notify/email/list");f.value=o.data.templates,[p.value]=o.data.templates}catch(o){_("success","Email \u5217\u8868\u51FA\u73FE\u932F\u8AA4",o.response.data.message)}finally{i.value=!1}};k(()=>{r()});const s=m(null),t=async()=>{try{i.value=!0;const o=await g.get("/v1/notify/email/template/schedules");s.value=o.data.schedules}catch(o){_("danger","\u9031\u671F\u6E05\u55AE\u51FA\u73FE\u932F\u8AA4",o.response.data.message)}finally{i.value=!1}};k(()=>{t()});const u=async(o,b)=>{try{i.value=!0;const n=await g.post(`/v1/notify/email/template/${o}/test`,{variables:b});_("success","Email \u767C\u9001\u7D50\u679C",n.data.message)}catch(n){_("danger","\u6E2C\u8A66 API \u51FA\u73FE\u932F\u8AA4",n.response.data.message)}finally{i.value=!1}},V=async(o,b)=>{try{i.value=!0;const n=await g.put(`/v1/notify/email/template/${o}`,b);_("success","Eamil \u6A23\u677F\u7DE8\u8F2F\u7D50\u679C",n.data.message),l.value=1,r()}catch(n){_("danger","\u7DE8\u8F2F Email \u6A23\u677F\u51FA\u73FE\u932F\u8AA4",n.response.data.message)}finally{i.value=!1}};return(o,b)=>(d(),c("div",ae,[L(a(T),{active:i.value,"is-full-page":E.value,"z-index":1021},null,8,["active","is-full-page"]),oe,e("div",ne,[e("div",ie,[e("div",de,[(d(!0),c(x,null,$(f.value,n=>(d(),c("a",{key:n.id,href:"#",class:j(["list-group-item",l.value===n.id?"active":""]),"aria-current":"true",onClick:U(ue=>(p.value=n,l.value=n.id),["prevent"])},h(n.cht_name),11,ce))),128))])]),e("div",re,[L(le,{data:p.value,"schedules-list":s.value,onEmailTest:u,onEditEmail:V},null,8,["data","schedules-list"])])])]))}};export{_e as default};
