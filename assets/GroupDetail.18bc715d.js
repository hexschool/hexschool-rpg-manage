import{_ as oe,l as te,N as le,r,s as ne,o as ie,z as D,a as g,c as b,b as e,A as v,f as A,x as k,g as re,D as T,F as B,q as O,w as _,C as S,h as P,v as N,Q as ce,R as de,S as ue,y as pe}from"./index.b171e68b.js";import{a as _e}from"./task.face143e.js";import{a as ve}from"./task-tags.e1e95587.js";const i=y=>(de("data-v-e70eaf3a"),y=y(),ue(),y),he={class:"taskGroupDetail px-4 mt-4"},me={class:"border-bottom border-light pb-2 mb-3"},fe={"aria-label":"breadcrumb"},ge={class:"breadcrumb"},be={class:"breadcrumb-item"},ke=i(()=>e("li",{class:"breadcrumb-item active","aria-current":"page"}," \u7DE8\u8F2F\u4EFB\u52D9\u7FA4\u7D44 ",-1)),ye=i(()=>e("h1",{class:"fs-4"},"\u7DE8\u8F2F\u4EFB\u52D9\u7FA4\u7D44",-1)),Ge={class:"row"},Le={class:"col-md-6"},we={class:"mb-3"},xe=i(()=>e("label",{for:"taskGroupInfoName",class:"form-label"},"\u4EFB\u52D9\u7FA4\u7D44\u540D\u7A31",-1)),De={class:"col-md-6"},Ce={class:"mb-3"},Ve=i(()=>e("label",{for:"taskGroupInfoKeyword",class:"form-label"},"\u82F1\u6587\u540D\u7A31",-1)),Ee={class:"card shadow-sm rounded-4 overflow-hidden mb-3"},Ue=i(()=>e("div",{class:"card-header bg-white py-3"}," \u5206\u985E\u6A19\u7C64 ",-1)),Ie={class:"list-unstyled mb-0"},Te={class:"form-check"},Se=["value","id","checked"],Ne=["for"],$e=i(()=>e("hr",null,null,-1)),Fe={class:"mb-3"},Me=i(()=>e("label",{for:"taskGroupDescription",class:"form-label"},"\u63CF\u8FF0",-1)),Re={class:"row"},Ke={class:"col-md-6"},He={class:"mb-3"},qe=i(()=>e("label",{class:"form-label",for:"groupEnd"},"\u5230\u671F\u65E5",-1)),Ae={class:"form-check mb-3"},Be=["checked"],Oe=i(()=>e("label",{class:"form-check-label",for:"showCheck"}," \u662F\u5426\u986F\u793A ",-1)),Pe=i(()=>e("hr",null,null,-1)),ze={class:"my-3"},je=i(()=>e("label",{class:"form-label",for:"userGroup"},"\u5C0D\u61C9\u4F7F\u7528\u8005\u7FA4\u7D44",-1)),Qe=i(()=>e("option",{value:"choose"},"\u9078\u64C7\u4F7F\u7528\u8005\u7FA4\u7D44",-1)),Je=i(()=>e("option",{value:""},"\u4E0D\u8A2D\u5B9A",-1)),We=[Qe,Je],Xe={class:"card-header bg-white py-3"},Ye={class:"row align-items-center justify-content-between"},Ze=i(()=>e("div",{class:"col"},[e("p",{class:"mb-sm-0"},"\u4F7F\u7528\u8005\u7FA4\u7D44\u5217\u8868")],-1)),es={class:"col-sm-6"},ss={class:"input-group"},as={class:"list-unstyled mb-0"},os={class:"form-check"},ts=["value","id","checked"],ls=["for"],ns=i(()=>e("hr",null,null,-1)),is=i(()=>e("button",{type:"submit",class:"btn btn-primary d-block ms-auto"}," \u78BA\u8A8D\u66F4\u65B0 ",-1)),rs={__name:"GroupDetail",setup(y){const{apiGetTaskGroupDetail:z,apiPutTaskGroupDetail:j}=_e,{apiGetUserGroups:Q}=pe,{apiGetTaskTags:J}=ve,W=te(),C=le.useLoading(),u=r(""),p=r([]),t=r({}),$=async a=>{var c,n;const s=C.show();try{const{task_group:l}=await z(a);t.value={...l},t.value.expired_at=new Date(t.value.expired_at).toLocaleDateString("sv-SE"),t.value.user_groups.length!==0&&(u.value="choose",t.value.user_groups.forEach(d=>{p.value.push(d.id)}))}catch(l){k("danger","\u53D6\u5F97\u4EFB\u52D9\u7FA4\u7D44\u5931\u6557",`${(c=l.response)==null?void 0:c.data.statusCode}:${(n=l.response)==null?void 0:n.data.message}`)}finally{s.hide()}},X=()=>{u.value===""&&(p.value=[])},h=r([]),Y=()=>{h.value.forEach(a=>{t.value.user_groups.forEach(s=>{a.id===s.id&&(a.isChecked=!0,p.value.includes(a.id)||p.value.push(a.id))})})},G=r({userGroupsList:[],pagination:{total:100,count:10,total_page:10,current_page:1}}),F=r(1),V=r(!1),L=r(""),E=async({page:a=1,keyword:s=""}={})=>{const c=C.show();V.value=!0;try{const{groups:n,pagination:l}=await Q({page:a,keyword:s});n.forEach(d=>{d.isChecked=!1}),G.value.userGroupsList=n,G.value.pagination=l,F.value=l.current_page,a===1?h.value=n:h.value=[...h.value,...n],Y()}catch(n){k("danger","\u53D6\u5F97\u4F7F\u7528\u8005\u7FA4\u7D44\u5217\u8868\u5931\u6557",`${n.response.data.statusCode}:${n.response.data.message}`)}finally{c.hide(),V.value=!1}},M=r(null),R=()=>{const a=M.value;a.addEventListener("scroll",s=>{if(s.target.clientHeight+s.target.scrollTop>=a.scrollHeight){if(V.value||G.value.pagination.current_page===G.value.pagination.total_page)return;E({page:F.value+1,keyword:L.value})}})};ne(u,a=>{a==="choose"&&R()});const m=r([]),w=r([]),Z=()=>{w.value.forEach(a=>{t.value.tags.forEach(s=>{a.name===s&&m.value.indexOf(a.id)===-1&&(a.isChecked=!0,m.value.push(a.id))})})},x=r({tagsList:[],pagination:{total:100,count:10,total_page:10,current_page:1}}),K=r(1),U=r(!1),H=async(a=1)=>{var c,n;const s=C.show();U.value=!0;try{const{task_tags:l,pagination:d}=await J({page:a});l.forEach(f=>{f.isChecked=!1}),x.value.tagsList=l,x.value.pagination=d,K.value=d.current_page,w.value=[...w.value,...l],Z()}catch(l){k("danger","\u53D6\u5F97\u5206\u985E\u6A19\u7C64\u5217\u8868\u5931\u6557",`${(c=l.response)==null?void 0:c.data.statusCode}:${(n=l.response)==null?void 0:n.data.message}`)}finally{s.hide(),U.value=!1}},q=r(null),ee=()=>{const a=q.value;a.addEventListener("scroll",s=>{if(s.target.clientHeight+s.target.scrollTop>=a.scrollHeight){if(U.value||x.value.pagination.current_page===x.value.pagination.total_page)return;H(K.value+1)}})},se=async a=>{try{const s={name:t.value.name,tag_ids:[...m.value],description:t.value.description,expired_at:new Date(t.value.expired_at).toISOString(),user_group_ids:[...p.value],enable:!!t.value.enable};await j(a,s),k("success","\u66F4\u65B0\u4EFB\u52D9\u7FA4\u7D44\u6210\u529F","\u5DF2\u6210\u529F\u7DE8\u8F2F\u4EFB\u52D9\u7FA4\u7D44"),$(a)}catch(s){k("danger","\u66F4\u65B0\u4EFB\u52D9\u7FA4\u7D44\u5931\u6557",`${s.response.data.statusCode}:${s.response.data.message}`)}},ae=()=>{E({page:1,keyword:L.value})};return ie(async()=>{const{id:a}=W.params;await $(a),E(),H(),u.value==="choose"&&R(),ee()}),(a,s)=>{const c=D("router-link"),n=D("Field"),l=D("ErrorMessage"),d=D("VForm");return g(),b("div",he,[e("header",me,[e("nav",fe,[e("ol",ge,[e("li",be,[v(c,{to:"/admin/task/group"},{default:A(()=>[re(" \u4EFB\u52D9\u7FA4\u7D44 ")]),_:1})]),ke])]),ye]),v(d,{ref:"taskGroupForm",onSubmit:s[9]||(s[9]=f=>se(t.value.id))},{default:A(({errors:f})=>[e("div",Ge,[e("div",Le,[e("div",we,[xe,v(n,{id:"taskGroupInfoName",modelValue:t.value.name,"onUpdate:modelValue":s[0]||(s[0]=o=>t.value.name=o),name:"\u4EFB\u52D9\u7FA4\u7D44\u540D\u7A31",type:"text",class:T(["form-control",{"is-invalid":f.taskGroupInfoName}]),rules:"required"},null,8,["modelValue","class"]),v(l,{name:"taskGroupInfoName",class:"invalid-feedback"})])]),e("div",De,[e("div",Ce,[Ve,v(n,{disabled:"",id:"taskGroupInfoKeyword",modelValue:t.value.keyword,"onUpdate:modelValue":s[1]||(s[1]=o=>t.value.keyword=o),name:"taskGroupInfoKeyword",label:"\u82F1\u6587\u540D\u7A31",type:"text",class:T(["form-control",{"is-invalid":f.taskGroupInfoKeyword}]),rules:{required:!0}},null,8,["modelValue","class"]),v(l,{name:"taskGroupInfoKeyword",class:"invalid-feedback"})])])]),e("div",Ee,[Ue,e("div",{class:"card-body",ref_key:"tagListRef",ref:q},[e("ul",Ie,[(g(!0),b(B,null,O(w.value,o=>(g(),b("li",{key:o.id},[e("div",Te,[_(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=I=>m.value=I),value:o.id,id:o.id,checked:o.isChecked},null,8,Se),[[S,m.value]]),e("label",{class:"form-check-label",for:o.id},P(o.name),9,Ne)]),$e]))),128))])],512)]),e("div",Fe,[Me,_(e("textarea",{class:"form-control",id:"taskGroupDescription","onUpdate:modelValue":s[3]||(s[3]=o=>t.value.description=o),placeholder:"\u4EFB\u52D9\u7FA4\u7D44\u63CF\u8FF0"},null,512),[[N,t.value.description]])]),e("div",Re,[e("div",Ke,[e("div",He,[qe,_(e("input",{type:"date",class:"form-control",id:"groupEnd","onUpdate:modelValue":s[4]||(s[4]=o=>t.value.expired_at=o)},null,512),[[N,t.value.expired_at]])])])]),e("div",Ae,[_(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[5]||(s[5]=o=>t.value.enable=o),checked:t.value.enable,id:"showCheck"},null,8,Be),[[S,t.value.enable]]),Oe]),Pe,e("div",ze,[je,_(e("select",{class:"form-select",id:"userGroup",onChange:X,"onUpdate:modelValue":s[6]||(s[6]=o=>u.value=o)},We,544),[[ce,u.value]])]),e("div",{class:T(["card shadow-sm rounded-4 overflow-hidden mb-4",u.value?"d-block":"d-none"])},[e("div",Xe,[e("div",Ye,[Ze,e("div",es,[e("div",ss,[_(e("input",{type:"text",class:"form-control",placeholder:"\u641C\u5C0B\u4F7F\u7528\u8005\u7FA4\u7D44","onUpdate:modelValue":s[7]||(s[7]=o=>L.value=o)},null,512),[[N,L.value]]),e("button",{class:"btn btn-secondary",type:"button",onClick:ae},"\u641C\u5C0B")])])])]),e("div",{class:"card-body",ref_key:"userGroupsListRef",ref:M},[e("ul",as,[(g(!0),b(B,null,O(h.value,o=>(g(),b("li",{key:o.id},[e("div",os,[_(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[8]||(s[8]=I=>p.value=I),value:o.id,id:o.id,checked:o.isChecked},null,8,ts),[[S,p.value]]),e("label",{class:"form-check-label",for:o.id},P(o.name),9,ls)]),ns]))),128))])],512)],2),is]),_:1},512)])}}},_s=oe(rs,[["__scopeId","data-v-e70eaf3a"]]);export{_s as default};
