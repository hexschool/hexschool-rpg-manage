import{r as m,n as V,a as r,c as u,b as e,h as g,i as d,F as k,q as C,w as S,v as F,A as $,k as A,_ as E,j as D,E as w,D as M,p as R,R as H,S as N,o as U,d as b,x as f,L as z}from"./index.b171e68b.js";import{_ as B}from"./Editor.be61f9bc.js";import{g as I}from"./date.91ece2ba.js";const P={class:"card shadow-sm rounded-4 overflow-hidden mb-4 position-relative"},q={class:"card-body"},O={class:"card-title mb-3"},G={class:"mb-3 border-bottom"},J=e("h6",null,"\u89F8\u767C\u689D\u4EF6",-1),K={class:"mb-3 border-bottom"},Q=e("h6",null,"\u53EF\u7528\u6B04\u4F4D",-1),W={class:"table table-borderless"},X=e("thead",null,[e("tr",null,[e("th",{width:"100"}," \u6B04\u4F4D\u540D\u7A31 "),e("th",{width:"200"}," \u8B8A\u6578 "),e("th",null,"\u6E2C\u8A66\u5C08\u7528\u6E2C\u8A66\u6587\u5B57")])],-1),Y=["id","onUpdate:modelValue"],Z=A('<div class="row"><div class="col-md-6"><div class="mb-3"><label for="message_url" class="form-label">\u5C0D\u61C9\u9023\u7D50</label><input id="message_url" disabled type="text" class="form-control" value="/course/{% course_id %}"></div></div></div>',1),ee={class:"mb-3"},se=e("label",{for:"mail_content",class:"form-label"},"\u8A0A\u606F\u5167\u5BB9",-1),te={class:"d-flex justify-content-between mt-5"},ae={__name:"Message",props:{data:{type:Object,default:()=>({})}},emits:["messageTest","editMessage"],setup(h,{emit:t}){const x=h,p=m(null),{data:o}=V(x),_=(v,n)=>{const s=[];n.forEach(a=>{s.push({id:a.id,content:a.replace_keyword})}),t("messageTest",v,s)},y=(v,n)=>{const s={cht_name:n.cht_name,content:p.value.editorContent};t("editMessage",v,s)};return(v,n)=>(r(),u("div",P,[e("div",q,[e("h4",O,g(d(o).cht_name)+"\u56DE\u994B ",1),e("div",G,[J,e("p",null,g(d(o).trigger_description),1)]),e("div",K,[Q,e("table",W,[X,e("tbody",null,[(r(!0),u(k,null,C(d(o).variables,s=>(r(),u("tr",{key:`message_${s.id}`},[e("td",null,g(s.cht_name),1),e("td",null,"{% "+g(s.name)+" %}",1),e("td",null,[S(e("input",{id:s.name,"onUpdate:modelValue":a=>s.replace_keyword=a,type:"text",class:"form-control"},null,8,Y),[[F,s.replace_keyword]])])]))),128))])])]),Z,e("div",ee,[se,$(B,{ref_key:"editorRef",ref:p,content:d(o).content},null,8,["content"])]),e("div",te,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:n[0]||(n[0]=s=>_(d(o).id,d(o).variables,d(o).content))}," \u6E2C\u8A66\u767C\u9001 "),e("button",{type:"button",class:"btn btn-secondary",onClick:n[1]||(n[1]=s=>y(d(o).id,h.data))}," \u78BA\u8A8D\u66F4\u65B0 ")])])]))}};const T=h=>(H("data-v-05efe2fc"),h=h(),N(),h),ne={class:"mt-5"},oe={class:"right dropdown-container expanded"},le={id:"notification",class:"position-fixed",style:{bottom:"30px",right:"40px","z-index":"10000"}},ie=T(()=>e("span",{class:"material-icons"}," notifications ",-1)),ce=[ie],de={class:"tabs"},re={class:"h_tabs-nav d-flex p-0 list-unstyled"},ue={class:"h_notice_content"},_e={key:0,id:"h_unread_notice",class:"h_notice_area"},he={class:"d-flex"},pe=T(()=>e("div",{class:"d-flex flex-column align-items-center"},[e("img",{src:"https://fakeimg.pl/300/",alt:"",width:"48",height:"48",class:"rounded-circle"})],-1)),ve={class:"media-body ms-2"},me=["innerHTML"],fe={class:"d-inline-block text-muted"},ge={style:{width:"10px"}},ye=["onClick"],be={key:1,d:"h_all_notice",class:"h_notice_area"},xe={class:"d-flex"},$e=T(()=>e("div",{class:"d-flex flex-column align-items-center"},[e("img",{src:"https://fakeimg.pl/300/",alt:"",width:"48",height:"48",class:"rounded-circle"})],-1)),we={class:"media-body ms-2"},Me=["innerHTML"],ke={class:"d-inline-block text-muted"},Ce=["onClick"],Le={__name:"MessageFront",props:{data:{type:Array}},emits:["readMessage","unreadMessage"],setup(h,{emit:t}){const x=h,{data:p}=V(x),o=m(!1),_=m("h_unread_notice"),y=D(()=>p.value.filter(n=>!!n.has_read).reverse()),v=D(()=>p.value.filter(n=>!n.has_read).reverse());return(n,s)=>(r(),u("div",ne,[e("div",oe,[e("div",le,[e("a",{href:"#","data-dropdown":"notificationMenu",class:"notification-icon d-flex align-items-center justify-content-center rounded-circle text-decoration-none text-primary",onClick:s[0]||(s[0]=w(a=>o.value=!o.value,["prevent"]))},ce)]),e("ul",{name:"notificationMenu",class:M(["h_dropdown shadow bg-white m-0 p-0 rounded-4 overflow-hidden",{show:o.value}])},[e("div",de,[e("ul",re,[e("li",{class:M(["flex-fill",{"tab-active":_.value=="h_unread_notice"}])},[e("a",{href:"#h_unread_notice",onClick:s[1]||(s[1]=w(a=>_.value="h_unread_notice",["prevent"]))}," \u672A\u8B80\u901A\u77E5 ")],2),e("li",{class:M(["flex-fill",{"tab-active":_.value=="h_all_notice"}])},[e("a",{href:"#h_all_notice",onClick:s[2]||(s[2]=w(a=>_.value="h_all_notice",["prevent"]))}," \u5DF2\u8B80\u901A\u77E5 ")],2)]),e("div",ue,[_.value=="h_unread_notice"?(r(),u("div",_e,[e("div",null,[(r(!0),u(k,null,C(d(v),a=>(r(),u("li",{key:a.id,class:"notification-group p-2 d-flex justify-content-between"},[e("div",he,[pe,e("div",ve,[e("p",{class:"mt-0 mb-0",innerHTML:a.content},null,8,me),e("small",null,[e("span",fe,g(d(I)(a.create_time)),1)])])]),e("div",ge,[e("span",{class:"un read",onClick:L=>t("readMessage",a.id)},null,8,ye)])]))),128))])])):R("",!0),_.value=="h_all_notice"?(r(),u("div",be,[e("div",null,[(r(!0),u(k,null,C(d(y),a=>(r(),u("li",{key:a.id,class:"notification-group p-2 d-flex justify-content-between"},[e("div",xe,[$e,e("div",we,[e("p",{class:"mt-0 mb-0",innerHTML:a.content},null,8,Me),e("small",null,[e("span",ke,g(d(I)(a.create_time)),1)])])]),e("span",{class:"read",onClick:L=>t("unreadMessage",a.id)},null,8,Ce)]))),128))])])):R("",!0)])])],2)])]))}},Te=E(Le,[["__scopeId","data-v-05efe2fc"]]),De={class:"px-4 mt-4"},Re=e("h4",{class:"mb-3"}," \u7AD9\u5167\u901A\u77E5\u8A0A\u606F ",-1),Ue={class:"row"},Ie={class:"col-md-3"},Ve={class:"list-group"},je=["onClick"],Se={class:"col-md-9"},Ne={__name:"Message",setup(h){const t=m(!1),x=m(!0),p=m(1),o=m(null),_=m({}),y=async()=>{try{t.value=!0;const l=await b.get("/v1/notify/message/list");o.value=l.data.templates,[_.value]=o.value}catch(l){f("danger","\u901A\u77E5\u5217\u8868\u51FA\u73FE\u932F\u8AA4",l.response.data.message)}finally{t.value=!1}};U(()=>{y()});const v=m([]),n=async()=>{try{t.value=!0;const l="https://best-hex-user.hexschool.com/v1/notify/message/list",i=await b.get(l);v.value=i.data.messages}catch(l){f("danger","\u53D6\u5F97\u7AD9\u5167\u8A0A\u606F\u5931\u6557",l.response.data.message)}finally{t.value=!1}};U(()=>{n()});const s=async l=>{try{t.value=!0;const i=`https://best-hex-user.hexschool.com/v1/notify/message/${l}/read`;await b.put(i),n()}catch(i){f("danger","\u5DF2\u8B80\u5931\u6557",i.response.data.message)}finally{t.value=!1}},a=async l=>{try{t.value=!0;const i=`https://best-hex-user.hexschool.com/v1/notify/message/${l}/unread`;await b.put(i),n()}catch(i){f("danger","\u5DF2\u8B80\u5931\u6557",i.response.data.message)}finally{t.value=!1}},L=async(l,i)=>{try{t.value=!0;const c=await b.post(`/v1/notify/message/template/${l}/test`,{variables:i});f("success","\u901A\u77E5\u6E2C\u8A66\u7D50\u679C",c.data.message),n()}catch(c){f("danger","\u6E2C\u8A66 API \u51FA\u73FE\u932F\u8AA4",c.response.data.message)}finally{t.value=!1}},j=async(l,i)=>{try{t.value=!0;const c=await b.put(`/v1/notify/message/template/${l}`,i);f("success","\u901A\u77E5\u6A23\u677F\u66F4\u65B0\u7D50\u679C",c.data.message),p.value=1,y()}catch(c){f("danger","\u7DE8\u8F2F\u7AD9\u5167\u8A0A\u606F\u6A23\u677F\u51FA\u73FE\u932F\u8AA4",c.response.data.message)}finally{t.value=!1}};return(l,i)=>(r(),u("div",De,[$(d(z),{active:t.value,"is-full-page":x.value,"z-index":1021},null,8,["active","is-full-page"]),Re,e("div",Ue,[e("div",Ie,[e("div",Ve,[(r(!0),u(k,null,C(o.value,c=>(r(),u("a",{key:c.id,href:"#",class:M(["list-group-item",p.value===c.id?"active":""]),onClick:w(Fe=>(_.value=c,p.value=c.id),["prevent"])},g(c.cht_name),11,je))),128))])]),e("div",Se,[$(ae,{data:_.value,onMessageTest:L,onEditMessage:j},null,8,["data"]),$(Te,{data:v.value,onReadMessage:s,onUnreadMessage:a},null,8,["data"])])])]))}};export{Ne as default};
