import{d as We,a1 as Fe,_ as Ae,N as Xe,l as He,r as C,m as Ze,o as Je,a as r,c as u,b as t,F,q as A,e as Ke,p as f,A as Ce,i as q,x as g,X,h as b,g as P,E as H,w as ke,v as $e,D as z,P as Qe,R as Ye,S as Ie,a2 as es}from"./index.b171e68b.js";import{C as ss,V as ts}from"./CoursesSurveys.ae688238.js";import{g as Z}from"./date.91ece2ba.js";import{a as as}from"./surveys.0ceefe2b.js";const J=We.create({baseURL:"https://best-hex-user.hexschool.com",withCredentials:!0,xsrfHeaderName:"xsrf-token",xsrfCookieName:"xsrf-token",withXSRFToken:!0,headers:{Authorization:`Bearer ${Fe("h_MqhC49RxFRI6pR3Z_token")}`}}),ls=w=>{const[B,E]=window.location.href.split("#"),{status:M}=w.response;switch(M){case 401:window.location.href=`https://rpg.hexschool.com/#/login?h_redirect=${B}&h_path=${E}`;break}return Promise.reject(w)};J.interceptors.request.use(w=>w,w=>Promise.reject(w));J.interceptors.response.use(w=>w.data,w=>ls(w));const is=()=>J.get("/v1/user/personal/profile"),os={apiGetUserPersonalInfo:is};const k=w=>(Ye("data-v-84aaa1f9"),w=w(),Ie(),w),ns={class:"surveys px-4 mt-4 position-relative"},ds=k(()=>t("h1",{class:"fs-4 mb-0"}," \u8AB2\u7A0B\u8A55\u50F9 ",-1)),cs={class:"row gx-3 gy-2 align-items-center my-2"},rs={class:"col-md-6"},us={class:"row gx-3 gy-2 align-items-center"},ps={class:"col-md-8 d-flex align-items-center"},hs=k(()=>t("label",{for:"inputState",class:"form-label flex-shrink-0 me-2 mb-0"},"\u7BE9\u9078\u65B9\u5F0F",-1)),vs=k(()=>t("option",{value:""}," \u5168\u90E8\u8A55\u50F9 ",-1)),_s=k(()=>t("option",{value:"has_reply=0"}," \u672A\u56DE\u8986 ",-1)),ys=k(()=>t("option",{value:"has_reply=1"}," \u5DF2\u56DE\u8986 ",-1)),gs=k(()=>t("option",{value:"has_content=1"}," \u6709\u8A55\u8AD6 ",-1)),ws=["value"],fs={class:"card mt-4"},bs=k(()=>t("div",{class:"card-header bg-primary text-white"},[t("h2",{class:"h4 m-2"}," \u5B78\u54E1\u56DE\u994B ")],-1)),Cs={class:"card-body bg-light"},ks={class:"list-unstyled"},$s={class:"card"},ms={class:"card-body d-flex shadow-sm"},xs=["src","alt"],Vs={class:"ms-2"},Rs={class:"d-flex align-items-center m-0",style:{height:"40px"}},Ss=["onClick"],Ds=k(()=>t("span",{class:"material-icons align-bottom ms-2 text-muted"}," disabled_visible ",-1)),Ps=[Ds],Ls=["onClick"],Ts=k(()=>t("span",{class:"material-icons align-bottom ms-2"}," disabled_visible ",-1)),qs={class:"d-flex align-items-center my-2"},Us={class:"text-muted ms-1"},js=["onClick"],zs={key:1,class:"card bg-light",style:{width:"752px"}},Bs={class:"card-body"},Es={class:"d-flex align-items-center"},Ms=["src"],Ns={class:"ms-2 mb-0"},Os={key:0,class:"text-muted"},Gs={key:0,class:"mt-3"},Ws={class:"pre-line"},Fs={key:1},As=k(()=>t("p",null,[t("small",{class:"text-muted"}," \u9650\u5236 200 \u500B\u5B57\uFF0C\u50C5\u80FD\u8F38\u5165\u6578\u5B57\u3001\u82F1\u6587\u3001\u4E2D\u6587\u5B57\u3001\u6A19\u9EDE\u7B26\u865F\uFF08\u9017\u865F\u3001\u53E5\u865F\u3001\u9A5A\u5606\u865F\u3001\u554F\u865F\u3001\u9813\u865F\uFF09 ")],-1)),Xs=["onClick"],Hs={key:3,class:"d-flex justify-content-between"},Zs=["onClick"],Js={class:"mb-0"},Ks=["onClick"],Qs={class:"card-footer bg-white d-flex"},Ys={class:"ms-5"},Is={class:"my-3"},et=["onClick"],st={key:0},tt={class:"row"},at={class:"rounded-box bg-primary text-white d-flex justify-content-center align-items-center rounded-pill me-2"},lt={class:"m-0"},it={key:0},ot=k(()=>t("p",{class:"text-muted"}," \u7D66\u8001\u5E2B\u7684\u6084\u6084\u8A71 ",-1)),nt=["onClick"],dt={key:1,class:"card bg-light",style:{width:"752px"}},ct={class:"card-body"},rt={class:"d-flex align-items-center"},ut=["src"],pt={class:"ms-2 mb-0"},ht={key:0,class:"text-muted"},vt={key:0,class:"mt-3"},_t={class:"pre-line"},yt={key:1},gt=k(()=>t("p",null,[t("small",{class:"text-muted"}," \u9650\u5236 200 \u500B\u5B57\uFF0C\u50C5\u80FD\u8F38\u5165\u6578\u5B57\u3001\u82F1\u6587\u3001\u4E2D\u6587\u5B57\u3001\u6A19\u9EDE\u7B26\u865F\uFF08\u9017\u865F\u3001\u53E5\u865F\u3001\u9A5A\u5606\u865F\u3001\u554F\u865F\u3001\u9813\u865F\uFF09 ")],-1)),wt=["onClick"],ft={key:3,class:"d-flex justify-content-between"},bt=["onClick"],Ct={class:"mb-0"},kt=["onClick"],$t={class:"d-flex justify-content-end"},mt={__name:"SurveysDetail",setup(w){const{apiGetVideoCoursesDetail:B,apiGetVideoCoursesComments:E,apiGetVideoCoursesComment:M,apiPutVideoCoursesCommentsDisplay:me,apiDeleteVideoCoursesCommentsDisplay:xe,apiPostVideoCoursesCommentsReplys:Ve,apiPutVideoCoursesCommentsReplys:Re,apiPostVideoCoursesWhispers:Se,apiPutVideoCoursesWhispers:De}=as,{apiGetUserPersonalInfo:Pe}=os,m=Xe.useLoading(),Le=He(),U={starSize:24,readOnly:!0,activeColor:"#2A8356",showRating:!1},p=C({new:!1,edit:!1,id:null}),h=C({new:!1,edit:!1,id:null}),K=C(null),Q=C(null),N=Ze({}),x=C(null),O=C({}),Te=async l=>{var e,s,c,i;const d=m.show();try{const{review:a}=await B(l);O.value=a}catch(a){g("danger","\u53D6\u5F97\u8A55\u50F9\u8CC7\u8A0A\u5931\u6557",`${(s=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:s.statusCode}:${(i=(c=a==null?void 0:a.response)==null?void 0:c.data)==null?void 0:i.message}`)}finally{d.hide()}},Y=C([]);let G=[];const qe=()=>{const l=[];Y.value.forEach(e=>{e&&l.push(e)}),G=[].slice.call(l).map(e=>new es(e))},I=C([]),V=C({current_page:1,total:0}),D=async(l,d=N.name)=>{var s,c,i,a;const e=m.show();try{const{comments:o,pagination:_}=await E({videoCourseId:x.value,page:l,scoped:d});I.value=o,V.value=_}catch(o){g("danger","\u53D6\u5F97\u8A55\u50F9\u8CC7\u8A0A\u5931\u6557",`${(c=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:c.statusCode}:${(a=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:a.message}`)}finally{e.hide(),await X(),qe()}},L=C({}),Ue=async()=>{var d,e,s,c;const l=m.show();try{const{profile:i}=await Pe();L.value=i}catch(i){g("danger","\u53D6\u5F97\u4F7F\u7528\u8005\u8CC7\u8A0A\u5931\u6557",`${(e=(d=i==null?void 0:i.response)==null?void 0:d.data)==null?void 0:e.statusCode}:${(c=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:c.message}`)}finally{l.hide()}};Je(async()=>{const{id:l}=Le.params;x.value=l,await D(),Te(l),Ue()});const je=async l=>{var e,s,c,i;const d=m.show();try{await me(x.value,l),await D(V.value.current_page),g("success","\u66F4\u65B0\u6210\u529F","\u5DF2\u89E3\u9664\u96B1\u85CF")}catch(a){g("danger","\u53D6\u5F97\u8A55\u50F9\u8CC7\u8A0A\u5931\u6557",`${(s=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:s.statusCode}:${(i=(c=a==null?void 0:a.response)==null?void 0:c.data)==null?void 0:i.message}`)}finally{d.hide()}},ze=async l=>{var e,s,c,i;const d=m.show();try{await xe(x.value,l),await D(V.value.current_page),g("success","\u66F4\u65B0\u6210\u529F","\u5DF2\u96B1\u85CF")}catch(a){g("danger","\u53D6\u5F97\u8A55\u50F9\u8CC7\u8A0A\u5931\u6557",`${(s=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:s.statusCode}:${(i=(c=a==null?void 0:a.response)==null?void 0:c.data)==null?void 0:i.message}`)}finally{d.hide()}},R=C(""),Be=async l=>{var e,s,c,i;const d=m.show();try{await Ve(x.value,l,{content:R.value}),p.value.new=!1,p.value.id="",await D(V.value.current_page),g("success","\u56DE\u8986\u6210\u529F","\u5DF2\u56DE\u8986\u8A0A\u606F")}catch(a){g("danger","\u53D6\u5F97\u8A55\u50F9\u8CC7\u8A0A\u5931\u6557",`${(s=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:s.statusCode}:${(i=(c=a==null?void 0:a.response)==null?void 0:c.data)==null?void 0:i.message}`)}finally{d.hide()}},Ee=async(l,d)=>{var s,c,i,a;const e=m.show();try{const o={videoCourseId:x.value,commentId:l,replyId:d,body:{content:R.value}};await Re(o),p.value.edit=!1,p.value.id="",await D(V.value.current_page),g("success","\u56DE\u8986\u6210\u529F","\u5DF2\u56DE\u8986\u8A0A\u606F")}catch(o){g("danger","\u53D6\u5F97\u8A55\u50F9\u8CC7\u8A0A\u5931\u6557",`${(c=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:c.statusCode}:${(a=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:a.message}`)}finally{e.hide()}},j=async l=>{await X(),l==="whisper"&&Q.value[0].focus(),l==="comment"&&K.value[0].focus()},n=C([]),W=async(l,d)=>{var s,c,i,a;const e=m.show();try{const{review:o}=await M(x.value,l);o.status=!0,n.value[d]=o}catch(o){g("danger","\u53D6\u5F97\u8A55\u50F9\u8CC7\u8A0A\u5931\u6557",`${(c=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:c.statusCode}:${(a=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:a.message}`)}finally{e.hide(),await X(),G[d].show()}},Me=l=>{N.name=l.target.value,n.value=[],D(1,N.name)},S=C(""),Ne=async(l,d,e)=>{var c,i,a,o;const s=m.show();try{const _={videoCourseId:x.value,commentId:l,whisperId:d,body:{content:S.value}};await Se(_),h.value.new=!1,h.value.id=null,await W(l,e),g("success","\u56DE\u8986\u6210\u529F","\u5DF2\u56DE\u8986\u8A0A\u606F")}catch(_){g("danger","\u53D6\u5F97\u8A55\u50F9\u8CC7\u8A0A\u5931\u6557",`${(i=(c=_==null?void 0:_.response)==null?void 0:c.data)==null?void 0:i.statusCode}:${(o=(a=_==null?void 0:_.response)==null?void 0:a.data)==null?void 0:o.message}`)}finally{s.hide()}},Oe=async(l,d,e,s)=>{var i,a,o,_;const c=m.show();try{const $={videoCourseId:x.value,commentId:l,whisperId:d,replyId:e,body:{content:S.value}};await De($),h.value.edit=!1,h.value.id=null,await W(l,s),g("success","\u56DE\u8986\u6210\u529F","\u5DF2\u56DE\u8986\u8A0A\u606F")}catch($){g("danger","\u53D6\u5F97\u8A55\u50F9\u8CC7\u8A0A\u5931\u6557",`${(a=(i=$==null?void 0:$.response)==null?void 0:i.data)==null?void 0:a.statusCode}:${(_=(o=$==null?void 0:$.response)==null?void 0:o.data)==null?void 0:_.message}`)}finally{c.hide()}},Ge=l=>{n.value[l].status=!n.value[l].status,G[l].toggle()},ee=(l,d,e)=>l?d||"https://fakeimg.pl/300/":e&&e||"https://fakeimg.pl/300/";return(l,d)=>(r(),u("div",ns,[ds,t("form",cs,[t("div",rs,[t("div",us,[t("div",ps,[hs,t("select",{class:"form-select",onChange:d[0]||(d[0]=e=>Me(e))},[vs,_s,ys,gs,(r(),u(F,null,A(5,e=>t("option",{key:`sating${e}`,value:`rating=${6-e}`},b(6-e)+"\u661F\u8A55\u8AD6 ",9,ws)),64))],32)])])])]),O.value.id?(r(),Ke(ss,{key:0,data:O.value},null,8,["data"])):f("",!0),t("div",fs,[bs,t("div",Cs,[t("ul",ks,[(r(!0),u(F,null,A(I.value,(e,s)=>{var c,i,a,o,_,$,se,te,ae,le,ie,oe,ne,de,ce,re,ue,pe,he,ve,_e,ye,ge,we,fe;return r(),u("li",{key:e.id,class:"mb-4"},[t("div",$s,[t("div",ms,[t("img",{src:e.avatar,width:"40",height:"40",class:"rounded-pill",alt:e.nickname},null,8,xs),t("div",Vs,[t("p",Rs,[P(b(e.nickname)+" ",1),e.display?(r(),u("a",{key:0,href:"#",title:"\u96B1\u85CF\u8A55\u8AD6",onClick:H(v=>ze(e.id),["prevent"])},Ps,8,Ss)):(r(),u("a",{key:1,href:"#",title:"\u986F\u793A\u8A55\u8AD6",class:"text-danger text-decoration-none",onClick:H(v=>je(e.id),["prevent"])},[Ts,P(" \u53D6\u6D88\u96B1\u85CF ")],8,Ls))]),t("p",qs,[Ce(q(ts),{rating:e.rating,"star-size":U.starSize,"read-only":U.readOnly,"show-rating":U.showRating,"active-color":U.activeColor},null,8,["rating","star-size","read-only","show-rating","active-color"]),t("span",Us,b(q(Z)(e.create_time)),1)]),t("p",null,b(e.content),1),p.value.id!==e.id&&!e.reply?(r(),u("button",{key:0,type:"button",class:"btn btn-outline-primary",onClick:v=>{p.value.new=!0,p.value.edit=!1,p.value.id=e.id,R.value="",j("comment")}}," \u56DE\u8986 ",8,js)):f("",!0),p.value.new&&p.value.id===e.id||e.reply?(r(),u("div",zs,[t("div",Bs,[t("div",Es,[t("img",{src:ee((c=e.reply)==null?void 0:c.id,(i=e.reply)==null?void 0:i.avatar,L.value.avatar),width:"40",height:"40",class:"rounded-pill"},null,8,Ms),t("p",Ns,[P(b(((a=e.reply)==null?void 0:a.nickname)||L.value.nickname)+" ",1),p.value.new?f("",!0):(r(),u("span",Os,b(q(Z)((o=e.reply)==null?void 0:o.create_time)),1))])]),((_=e.reply)==null?void 0:_.content)&&!p.value.edit||p.value.id!==e.id?(r(),u("p",Gs,[t("pre",Ws,"                          "+b(($=e.reply)==null?void 0:$.content)+`
                        `,1)])):(r(),u("div",Fs,[ke(t("textarea",{ref_for:!0,ref_key:"commentTextareaRef",ref:K,"onUpdate:modelValue":d[1]||(d[1]=v=>R.value=v),class:"my-3 form-control bg-light border-1 form-control",placeholder:"\u8ACB\u8F38\u5165\u56DE\u8986\u5167\u5BB9...",rows:"3"},null,512),[[$e,R.value]]),As])),p.value.new&&p.value.id===e.id?(r(),u("button",{key:2,type:"button",class:"btn btn-primary",onClick:v=>Be(e.id)}," \u65B0\u589E\u56DE\u8986 ",8,Xs)):f("",!0),p.value.edit&&((se=e.reply)==null?void 0:se.content)&&p.value.id===e.id?(r(),u("div",Hs,[t("button",{type:"button",class:"btn btn-primary",onClick:v=>Ee(e.id,e.reply.id)}," \u9001\u51FA\u56DE\u8986 ",8,Zs),t("p",Js,[t("span",{class:z({"text-danger":R.value.length>200})},b(R.value.length),3),P("/200 ")])])):f("",!0),!p.value.edit&&((te=e.reply)==null?void 0:te.content)||p.value.id!==e.id?(r(),u("button",{key:4,class:"btn btn-primary",type:"button",onClick:v=>{var y;p.value.new=!1,p.value.edit=!0,p.value.id=e.id,R.value=(y=e.reply)==null?void 0:y.content,j("comment")}}," \u4FEE\u6539\u56DE\u8986 ",8,Ks)):f("",!0)])])):f("",!0)])]),t("div",Qs,[t("div",Ys,[t("p",Is,[t("a",{class:"d-flex fw-bold text-dark text-decoration-none",href:"#",role:"button","aria-expanded":"false","aria-controls":"collapseExample",onClick:H(v=>{var y;return(y=n.value[s])!=null&&y.id?Ge(s):W(e.id,s)},["prevent"])},[t("span",{class:z(["material-icons align-middle transition-all",{"rotate-90":!((ae=n.value[s])!=null&&ae.status)}])}," keyboard_arrow_down ",2),P(" \u67E5\u770B\u500B\u5225\u8A55\u5206 "),e.has_whisper?(r(),u("span",st,"(\u6709\u6084\u6084\u8A71)")):f("",!0)],8,et)]),t("div",{ref_for:!0,ref:v=>Y.value[s]=v,class:"collapse show mt-3"},[t("div",tt,[(r(!0),u(F,null,A((le=n.value[s])==null?void 0:le.questionnaires,(v,y)=>{var T,be;return r(),u("div",{key:`questionnaires${y}`,class:z(["d-flex align-items-center mb-3",{"col-md-6":((T=n.value[s])==null?void 0:T.questionnaires.length)<=2,"col-md-4":((be=n.value[s])==null?void 0:be.questionnaires.length)>=3}])},[t("span",at,b(v.rating),1),t("p",lt,b(v.question),1)],2)}),128))]),(ie=n.value[s])!=null&&ie.whisper?(r(),u("div",it,[ot,t("p",null,b(n.value[s].whisper.content),1),h.value.id!==((oe=n.value[s])==null?void 0:oe.whisper.id)&&!n.value[s].whisper.reply?(r(),u("button",{key:0,class:"btn btn-outline-primary",type:"button",onClick:v=>{var y;h.value.new=!0,h.value.edit=!1,h.value.id=(y=n.value[s])==null?void 0:y.whisper.id,S.value="",j("whisper")}}," \u56DE\u8986 ",8,nt)):f("",!0),h.value.new&&h.value.id===((ne=n.value[s])==null?void 0:ne.whisper.id)||n.value[s].whisper.reply?(r(),u("div",dt,[t("div",ct,[t("div",rt,[t("img",{src:ee((de=n.value[s].whisper.reply)==null?void 0:de.id,(ce=n.value[s].whisper.reply)==null?void 0:ce.avatar,L.value.avatar),width:"40",height:"40",class:"rounded-pill"},null,8,ut),t("p",pt,[P(b(((re=n.value[s].whisper.reply)==null?void 0:re.nickname)||L.value.nickname)+" ",1),h.value.new?f("",!0):(r(),u("span",ht,b(q(Z)((ue=n.value[s].whisper.reply)==null?void 0:ue.create_time)),1))])]),((pe=n.value[s].whisper.reply)==null?void 0:pe.content)&&!h.value.edit||h.value.id!==((he=n.value[s].whisper)==null?void 0:he.id)?(r(),u("p",vt,[t("pre",_t,"                              "+b((ve=n.value[s].whisper.reply)==null?void 0:ve.content)+`
                            `,1)])):(r(),u("div",yt,[ke(t("textarea",{ref_for:!0,ref_key:"whisperTextareaRef",ref:Q,"onUpdate:modelValue":d[2]||(d[2]=v=>S.value=v),class:"my-3 form-control bg-light border-1 form-control",placeholder:"\u8ACB\u8F38\u5165\u56DE\u8986\u5167\u5BB9...",type:"text",rows:"3"},null,512),[[$e,S.value]]),gt])),h.value.new&&h.value.id===((_e=n.value[s])==null?void 0:_e.whisper.id)?(r(),u("button",{key:2,type:"button",class:"btn btn-primary",onClick:v=>Ne(e.id,n.value[s].whisper.id,s)}," \u65B0\u589E\u56DE\u8986 ",8,wt)):f("",!0),h.value.edit&&((ye=n.value[s].whisper.reply)==null?void 0:ye.content)&&h.value.id===((ge=n.value[s].whisper)==null?void 0:ge.id)?(r(),u("div",ft,[t("button",{type:"button",class:"btn btn-primary",onClick:v=>{var y;return Oe(e.id,n.value[s].whisper.id,(y=n.value[s].whisper.reply)==null?void 0:y.id,s)}}," \u9001\u51FA\u56DE\u8986 ",8,bt),t("p",Ct,[t("span",{class:z({"text-danger":S.value.length>200})},b(S.value.length),3),P("/200 ")])])):f("",!0),!h.value.edit&&((we=n.value[s].whisper.reply)==null?void 0:we.content)||h.value.id!==((fe=n.value[s].whisper)==null?void 0:fe.id)?(r(),u("button",{key:4,class:"btn btn-primary",type:"button",onClick:v=>{var y,T;h.value.new=!1,h.value.edit=!0,h.value.id=(y=n.value[s].whisper)==null?void 0:y.id,S.value=(T=n.value[s].whisper.reply)==null?void 0:T.content,j("whisper")}}," \u4FEE\u6539\u56DE\u8986 ",8,kt)):f("",!0)])])):f("",!0)])):f("",!0)],512)])])])])}),128))]),t("div",$t,[Ce(q(Qe),{modelValue:V.value.current_page,"onUpdate:modelValue":d[3]||(d[3]=e=>V.value.current_page=e),records:V.value.total,"per-page":20,options:{chunk:6},onPaginate:D},null,8,["modelValue","records"])])])])]))}},Pt=Ae(mt,[["__scopeId","data-v-84aaa1f9"]]);export{Pt as default};
