import{r as n,a as r,e as X,f as V,g as U,b as e,h as B,M as Y,s as Q,o as P,z as S,A as f,D as H,c as b,F as E,q as G,p as O,N as ee,m as te,w as se,v as ae,O as oe,i as le,B as W,x as I,E as ne,P as ie}from"./index.b171e68b.js";import{B as de}from"./tab.ac64535a.js";import{a as Z}from"./task-tags.e1e95587.js";const ce=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," \u53D6\u6D88 ",-1),re={__name:"TagDeleteModal",props:{name:{type:String,default:""}},emits:["delete"],setup(A,{expose:L,emit:$}){const v=A,g=n(null);return L({modalRef:g}),(x,_)=>(r(),X(Y,{ref_key:"modalRef",ref:g,title:"\u522A\u9664\u6A19\u7C64",classList:"bg-danger text-white","has-footer":!0},{body:V(()=>[U(" \u4F60\u78BA\u5B9A\u8981\u522A\u9664 "),e("b",null,B(v.name),1),U(" \u6A19\u7C64\u55CE\uFF1F ")]),footer:V(()=>[ce,e("button",{type:"button",class:"btn btn-danger",onClick:_[0]||(_[0]=y=>$("delete"))}," \u522A\u9664 ")]),_:1},512))}},ue={class:"mb-3"},pe=e("label",{for:"name",class:"form-label"},"\u6A19\u7C64\u540D\u7A31",-1),me={class:"mb-3"},be=e("label",{for:"description",class:"form-label"},"\u63CF\u8FF0",-1),ve={key:0,class:"mt-4"},_e={class:"card shadow-sm rounded-4 overflow-hidden h-100"},ye=e("div",{class:"card-header bg-white py-2 d-flex align-items-center justify-content-between"},[e("h2",{class:"h6 mb-0 lh-base"},"\u5DF2\u5957\u7528\u6B64\u6A19\u7C64"),e("ul",{class:"nav nav-pills",id:"pills-tab",role:"tablist"},[e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link active",id:"pills-home-tab","data-bs-toggle":"pill","data-bs-target":"#pills-home",type:"button",role:"tab","aria-controls":"pills-home","aria-selected":"true"}," \u4EFB\u52D9\u7FA4\u7D44 ")]),e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link",id:"pills-profile-tab","data-bs-toggle":"pill","data-bs-target":"#pills-profile",type:"button",role:"tab","aria-controls":"pills-profile","aria-selected":"false"}," \u4EFB\u52D9 ")])])],-1),fe={class:"card-body",style:{"max-height":"230px","overflow-y":"scroll"}},ge={class:"tab-content",id:"pills-tabContent"},he={class:"tab-pane fade show active",id:"pills-home",role:"tabpanel","aria-labelledby":"pills-home-tab",tabindex:"0"},ke={class:"list-unstyled"},we={class:"tab-pane fade",id:"pills-profile",role:"tabpanel","aria-labelledby":"pills-profile-tab",tabindex:"0"},$e={class:"list-unstyled"},xe=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," \u53D6\u6D88 ",-1),Te=["disabled"],Me={__name:"TagModal",props:{type:{type:String,default:""},data:{type:Object,default:()=>({id:"",name:"",description:""})}},emits:["update"],setup(A,{expose:L,emit:$}){const v=A,{apiGetTaskTagById:g,apiPostTaskTags:x,apiPutTaskTagById:_}=Z,y=n(null),R=n(null);L({tagContentModalRef:R});const i=n("create"),T=n(""),u=n({name:"",description:""});Q(()=>{var o;return(o=v.data)==null?void 0:o.id},()=>{var o;(o=v.data)!=null&&o.id?(i.value="edit",T.value=v.data.id,u.value=JSON.parse(JSON.stringify(v.data))):(i.value="create",T.value="",u.value={name:"",description:""},y.value.resetForm())});const h=n({tasksApply:[],taskGroupsApply:[]}),D=async o=>{var d,l,m,c;try{const{task_tag:p}=await g(o);h.value={tasksApply:p.tasks_apply,taskGroupsApply:p.task_groups_apply}}catch(p){$("update",{type:"\u5931\u6557",status:i.value,error:`${(l=(d=p==null?void 0:p.response)==null?void 0:d.data)==null?void 0:l.statusCode}:${(c=(m=p==null?void 0:p.response)==null?void 0:m.data)==null?void 0:c.message}`})}};Q(()=>T.value,o=>{o&&D(o)});const k=n(!1),j=async()=>{var o,d,l,m;k.value=!0;try{if(i.value==="create")await x(u.value),u.value={name:"",description:""};else{const c={name:u.value.name,description:u.value.description};await _(T.value,c)}k.value=!1,$("update",{type:"\u6210\u529F",status:i.value})}catch(c){k.value=!1,u.value.name=v.data.name,u.value.description=v.data.description,$("update",{type:"\u5931\u6557",status:i.value,error:`${(d=(o=c==null?void 0:c.response)==null?void 0:o.data)==null?void 0:d.statusCode}: ${(m=(l=c==null?void 0:c.response)==null?void 0:l.data)==null?void 0:m.message}`})}},F=n();return P(()=>{F.value=document.querySelectorAll("#myTab button"),F.value.forEach(o=>{const d=new de(o);o.addEventListener("click",l=>{l.preventDefault(),d.show()})})}),(o,d)=>{const l=S("Field"),m=S("ErrorMessage"),c=S("router-link"),p=S("VForm");return r(),X(p,{ref_key:"tagForm",ref:y,onSubmit:j},{default:V(({errors:N})=>[f(Y,{ref_key:"tagContentModalRef",ref:R,title:i.value==="create"?"\u65B0\u589E\u6A19\u7C64":"\u7DE8\u8F2F\u6A19\u7C64",classList:"bg-light","has-footer":!0},{body:V(()=>[e("div",ue,[pe,f(l,{id:"name",modelValue:u.value.name,"onUpdate:modelValue":d[0]||(d[0]=t=>u.value.name=t),name:"name",label:"\u6A19\u7C64\u540D\u7A31",type:"text",class:H(["form-control",{"is-invalid":N.name}]),rules:{required:!0}},null,8,["modelValue","class"]),f(m,{name:"name",class:"invalid-feedback"})]),e("div",me,[be,f(l,{as:"textarea",id:"description",modelValue:u.value.description,"onUpdate:modelValue":d[1]||(d[1]=t=>u.value.description=t),name:"description",label:"\u63CF\u8FF0",type:"text",rules:{required:!0},class:H(["form-control",{"is-invalid":N.description}])},null,8,["modelValue","class"]),f(m,{name:"description",class:"invalid-feedback"})]),i.value==="edit"?(r(),b("div",ve,[e("div",_e,[ye,e("div",fe,[e("div",ge,[e("div",he,[e("ul",ke,[(r(!0),b(E,null,G(h.value.taskGroupsApply,t=>(r(),b("li",{class:"mb-2",key:t.id},B(t.name),1))),128))])]),e("div",we,[e("ul",$e,[(r(!0),b(E,null,G(h.value.tasksApply,t=>(r(),b("li",{class:"mb-2",key:t.id},[f(c,{target:"_blank",to:`/admin/task/list/${t.id}`},{default:V(()=>[U(B(t.name),1)]),_:2},1032,["to"])]))),128))])])])])])])):O("",!0)]),footer:V(()=>[xe,e("button",{type:"submit",class:"btn btn-primary",disabled:k.value},B(i.value==="create"?"\u65B0\u589E":"\u7DE8\u8F2F"),9,Te)]),_:2},1032,["title"])]),_:1},512)}}},Ce={class:"taskTag px-4 mt-4"},Ve=e("h1",{class:"fs-4 mb-3"},"\u6A19\u7C64\u7BA1\u7406",-1),Be={class:"d-flex justify-content-between align-items-center mb-3"},Le={class:"row w-75"},Re={class:"col-md-6"},Fe={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},Ie={class:"card-body p-0"},Ae={class:"table-responsive"},De={class:"table table-hover mb-0 text-nowrap",style:{"font-size":"14px"}},Ne=e("thead",{class:"bg-light"},[e("tr",null,[e("th",{scope:"col",class:"ps-4 py-3 text-muted border-0"}," \u6A19\u7C64\u540D\u7A31 "),e("th",{scope:"col",class:"ps-4 py-3 text-muted border-0"},"\u63CF\u8FF0"),e("th",{scope:"col",class:"ps-4 py-3 text-muted border-0"},"\u4F7F\u7528\u72C0\u614B"),e("th",{scope:"col",class:"ps-4 py-3 text-muted border-0"},"\u7DE8\u8F2F")])],-1),Se={class:"text-nowrap"},Pe={scope:"row",class:"ps-4"},Ue={scope:"row",class:"ps-4"},Ee={scope:"row",class:"ps-4"},Ge={key:0,class:"text-success"},Oe={key:1,class:"text-secondary"},je={scope:"row",class:"ps-4"},qe=["onClick"],ze=e("span",{class:"material-icons align-middle fs-6"}," edit ",-1),Je=["onClick"],Ke={key:0,class:"card-footer bg-white py-3"},Qe={class:"d-flex flex-wrap align-items-start"},Ye={__name:"Tag",setup(A){const{apiGetTaskTags:L,apiDeleteTaskTagById:$}=Z,v=ee.useLoading(),g=n(!1),x=n(""),_=n(""),y=n({current_page:1,total_page:0,total:30}),R=n([]),i=async(t=1,s=10)=>{var q,z,J,K;_.value!==""?x.value=`name=${_.value}`:x.value="";const a=v.show(),{task_tags:M,pagination:w}=await L({page:t,count:s,scoped:x.value});try{R.value=M,y.value=w}catch(C){I("danger","\u53D6\u5F97\u5206\u985E\u6A19\u7C64\u5217\u8868\u5931\u6557",`${(z=(q=C==null?void 0:C.response)==null?void 0:q.data)==null?void 0:z.statusCode}:${(K=(J=C==null?void 0:C.response)==null?void 0:J.data)==null?void 0:K.message}`)}finally{a.hide()}},T=t=>{i(t)};P(async()=>{await i()});const h=te({type:"",data:{}}),D=n(null);let k=null;P(()=>{k=new W(D.value.tagContentModalRef.hModal)});const F=(t,s={})=>{h.type=t,h.data=s,k.show()},o=t=>{const s=t.status==="created"?"\u5EFA\u7ACB":"\u7DE8\u8F2F";t.type==="\u6210\u529F"?I("success",`${s}\u6A19\u7C64\u6210\u529F`,`\u5DF2\u6210\u529F${s}\u6A19\u7C64`):t.type==="\u5931\u6557"&&I("danger",`${s}\u6A19\u7C64\u5931\u6557`,t.error),k.hide(),i()},d=n(null),l=n({id:"",name:""});let m=null;P(()=>{m=new W(d.value.modalRef.hModal)});const p=(t,s)=>{l.value.id=t,l.value.name=s,m.show()},N=async()=>{var t,s,a,M;try{await $(l.value.id),I("success","\u522A\u9664\u6A19\u7C64\u6210\u529F","\u5DF2\u6210\u529F\u522A\u9664\u6A19\u7C64")}catch(w){I("danger","\u522A\u9664\u6A19\u7C64\u5931\u6557",`${(s=(t=w==null?void 0:w.response)==null?void 0:t.data)==null?void 0:s.statusCode}:${(M=(a=w==null?void 0:w.response)==null?void 0:a.data)==null?void 0:M.message}`)}finally{m.hide(),l.value.id="",l.value.name="",i()}};return(t,s)=>(r(),b("div",Ce,[Ve,e("div",Be,[e("div",Le,[e("div",Re,[se(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>_.value=a),onCompositionstart:s[1]||(s[1]=a=>g.value=!0),onCompositionend:s[2]||(s[2]=a=>g.value=!1),placeholder:"\u641C\u5C0B\u4EFB\u52D9\u6A19\u7C64",class:"form-control",onKeydown:s[3]||(s[3]=oe(ne(()=>{g.value||i(1)},["prevent"]),["enter"]))},null,544),[[ae,_.value]])])]),e("button",{class:"btn btn-primary",onClick:s[4]||(s[4]=a=>F("create"))}," \u65B0\u589E\u6A19\u7C64 ")]),e("div",Fe,[e("div",Ie,[e("div",Ae,[e("table",De,[Ne,e("tbody",Se,[(r(!0),b(E,null,G(R.value,a=>(r(),b("tr",{key:a.id,class:"align-middle"},[e("td",Pe,B(a.name),1),e("td",Ue,B(a.description),1),e("td",Ee,[a.is_used?(r(),b("span",Ge,"\u5DF2\u4F7F\u7528")):(r(),b("span",Oe,"\u672A\u4F7F\u7528"))]),e("td",je,[e("button",{class:"btn btn-sm btn-outline-gray ms-1",onClick:M=>F("edit",a)},[ze,U(" \u7DE8\u8F2F ")],8,qe),a.is_used?O("",!0):(r(),b("button",{key:0,class:"btn btn-sm btn-outline-danger ms-2",onClick:M=>p(a.id,a.name)},"\u522A\u9664",8,Je))])]))),128))])])])]),y.value.total_page>1?(r(),b("div",Ke,[e("div",Qe,[f(le(ie),{modelValue:y.value.current_page,"onUpdate:modelValue":s[5]||(s[5]=a=>y.value.current_page=a),records:y.value.total,"per-page":10,options:{chunk:6},onPaginate:T},null,8,["modelValue","records"])])])):O("",!0)]),f(re,{ref_key:"alertRef",ref:d,onDelete:N,name:l.value.name},null,8,["name"]),f(Me,{ref_key:"tagModalRef",ref:D,type:h.type,data:h.data,onUpdate:o},null,8,["type","data"])]))}};export{Ye as default};
