import{_ as H,r as d,o as A,z as F,a as x,e as J,f as b,A as l,b as e,D as B,i as Q,L as ie,c as L,p as de,M as W,B as X,x as h,R as Y,S as Z,d as K,h as V,N as re,u as ce,w as ue,v as me,O as pe,g as w,F as q,q as O,E as $,P as _e}from"./index.b171e68b.js";import{a as E}from"./training.84f193f2.js";const M=m=>(Y("data-v-bdc21449"),m=m(),Z(),m),ge={class:"row"},ve={class:"col-md-6"},fe={class:"mb-3"},be=M(()=>e("label",{for:"name",class:"form-label"},"\u57F9\u8A13\u73ED\u540D\u7A31",-1)),he={class:"row"},ye={class:"col-md-6"},we={class:"mb-3"},$e=M(()=>e("label",{for:"start_at",class:"form-label"},"\u57F9\u8A13\u73ED\u958B\u59CB\u6642\u9593",-1)),xe={class:"col-md-6"},Me={class:"mb-3"},ke=M(()=>e("label",{for:"end_at",class:"form-label"},"\u57F9\u8A13\u73ED\u7D50\u675F\u6642\u9593",-1)),Te={class:"row"},Le={class:"col-md-6"},Ve={class:"mb-3"},Ce=M(()=>e("label",{for:"training-img",class:"form-label"},"\u4E0A\u50B3\u5C01\u9762",-1)),Ie={class:"mb-2"},De={class:"position-relative"},Se=M(()=>e("small",{class:"text-primary"},"\u9650\u5236\u5716\u7247\u5C3A\u5BF8 1200*628",-1)),Re={class:"col-md-6 d-flex justify-content-center align-items-center"},Be=["src"],Ue={class:"row"},ze={class:"col-md-6"},Fe={class:"mb-3"},Ne=M(()=>e("label",{for:"discord_role",class:"form-label"},"\u5C0D\u61C9 Discord \u8EAB\u4EFD\u7D44",-1)),je=M(()=>e("hr",{class:"my-4"},null,-1)),qe={class:"d-flex justify-content-end"},Ae=M(()=>e("button",{type:"button",class:"btn btn-outline-secondary me-2","data-bs-dismiss":"modal"}," \u53D6\u6D88 ",-1)),Ee=["disabled"],Pe={__name:"TrainingModal",emits:["getTrainingList"],setup(m,{expose:I,emit:D}){const{apiPostTraining:k}=E,o=d({name:"",start_at:"",end_at:"",cover_url:"",discord_role:""}),c=d(null),p=d(null);A(()=>{p.value=new X(c.value.hModal)});const S=()=>{p.value.show()},v=()=>{p.value.hide()},u=d(!1),T=d(""),_=n=>{const t=new Image;t.src=n,t.onload=()=>{t.complete&&(t.width===1200&&t.height===628?u.value=!0:(u.value=!1,T.value=`${t.width}x${t.height}`,h("danger","\u5716\u7247\u5C3A\u5BF8\u932F\u8AA4",`\u76EE\u524D\u5716\u7247\u5C3A\u5BF8\u70BA\uFF1A${T.value}`)))}},U=async()=>{var n,t,s,a;try{u.value?(await k(o.value),h("success","\u65B0\u589E\u57F9\u8A13\u73ED\u6210\u529F",`\u6210\u529F\u65B0\u589E ${o.value.name}`),D("getTrainingList")):h("danger","\u65B0\u589E\u57F9\u8A13\u73ED\u5931\u6557","\u5716\u7247\u5C3A\u5BF8\u932F\u8AA4")}catch(i){h("danger","\u65B0\u589E\u57F9\u8A13\u73ED\u5931\u6557",`${(t=(n=i==null?void 0:i.response)==null?void 0:n.data)==null?void 0:t.statusCode} : ${(a=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:a.message}`)}o.value={name:"",start_at:"",end_at:"",cover_url:"",discord_role:""},v()},f=d(!1),z=n=>new Promise((t,s)=>{const a=new FileReader;a.readAsArrayBuffer(n),a.onload=i=>{const{result:g}=i.target;t(g)},a.onerror=s}),R=(n,t)=>{f.value=!1,n.target.value="",h("danger","\u5716\u7247\u4E0A\u50B3\u5931\u6557",`${t}`)},N=n=>{f.value=!0;const t=n.target.files[0],s=3*1024*1024;if(t.size>s){R(n,"\u5716\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u904E 3MB");return}if(t){const i=`/v1/common/upload/image/${t.type.split("/")[1]}`,g=new FileReader;g.onload=j=>{const r=new Image;r.onload=()=>{const{width:ee,height:te}=r;ee===1200&&te===628?(async()=>{try{const P=await z(t),{data:G}=await K.get(i),ae=G.image_url,se=G.upload_url,ne={transformRequest(oe,le){return delete le.common.Authorization,oe},headers:{"Content-Type":t.type},withCredentials:!1};await K.put(se,P,ne),o.value.cover_url=ae,f.value=!1}catch{R(n,"\u5716\u7247\u4E0A\u50B3\u5931\u6557\uFF0C\u8ACB\u91CD\u65B0\u4E0A\u50B3\u3002")}})():R(n,"\u5716\u7247\u5BEC\u9AD8\u9700\u7B26\u5408 1200 x 628")},r.src=j.target.result},g.readAsDataURL(t)}};return I({openModal:S,hideModal:v}),(n,t)=>{const s=F("Field"),a=F("ErrorMessage"),i=F("VForm");return x(),J(W,{ref_key:"modalRef",ref:c,title:"",modalSize:"modal-lg",classList:"text-dark pb-0","has-footer":!1},{body:b(()=>[l(i,{onSubmit:U},{default:b(({errors:g,meta:j})=>[e("div",ge,[e("div",ve,[e("div",fe,[be,l(s,{modelValue:o.value.name,"onUpdate:modelValue":t[0]||(t[0]=r=>o.value.name=r),id:"name",name:"name",label:"\u57F9\u8A13\u73ED\u540D\u7A31",type:"text",class:B([{"is-invalid":g.name},"form-control"]),placeholder:"ex: Vue \u76F4\u64AD\u73ED 2022 \u6625\u5B63\u73ED",rules:"required"},null,8,["modelValue","class"]),l(a,{name:"name",class:"invalid-feedback"})])])]),e("div",he,[e("div",ye,[e("div",we,[$e,l(s,{modelValue:o.value.start_at,"onUpdate:modelValue":t[1]||(t[1]=r=>o.value.start_at=r),id:"start_at",name:"start_at",label:"\u958B\u59CB\u6642\u9593",type:"date",class:B([{"is-invalid":g.start_at},"form-control"]),placeholder:"ex: Vue \u76F4\u64AD\u73ED 2022 \u6625\u5B63\u73ED",rules:"required","format-value":"yyyy-MM-dd"},null,8,["modelValue","class"]),l(a,{name:"start_at",class:"invalid-feedback"})])]),e("div",xe,[e("div",Me,[ke,l(s,{modelValue:o.value.end_at,"onUpdate:modelValue":t[2]||(t[2]=r=>o.value.end_at=r),id:"end_at",name:"end_at",label:"\u7D50\u675F\u6642\u9593",type:"date",class:B([{"is-invalid":g.end_at},"form-control"]),rules:"required","format-value":"yyyy-MM-dd"},null,8,["modelValue","class"]),l(a,{name:"end_at",class:"invalid-feedback"})])])]),e("div",Te,[e("div",Le,[e("div",Ve,[Ce,e("div",Ie,[l(s,{modelValue:o.value.cover_url,"onUpdate:modelValue":t[3]||(t[3]=r=>o.value.cover_url=r),id:"cover_url",name:"cover_url",label:"\u5C01\u9762\u7DB2\u5740",placeholder:"\u5716\u7247\u7DB2\u5740",type:"url",class:B([{"is-invalid":g.cover_url},"form-control"]),disabled:f.value,onInput:t[4]||(t[4]=r=>_(o.value.cover_url)),rules:{required:!0,url:!0}},null,8,["modelValue","class","disabled"]),l(a,{name:"cover_url",class:"invalid-feedback"})]),e("div",De,[l(Q(ie),{active:f.value,"is-full-page":!1,width:30,height:30},null,8,["active"]),e("input",{type:"file",class:"inputFile form-control",accept:".png,.jpg,.jpeg",id:"training-img",placeholder:"ex: \u76F4\u64AD\u73ED\u5C01\u9762\u5716",onChange:N},null,32),Se])])]),e("div",Re,[o.value.cover_url?(x(),L("img",{key:0,class:"img-fluid",src:o.value.cover_url,style:{height:"200px"}},null,8,Be)):de("",!0)])]),e("div",Ue,[e("div",ze,[e("div",Fe,[Ne,l(s,{modelValue:o.value.discord_role,"onUpdate:modelValue":t[5]||(t[5]=r=>o.value.discord_role=r),id:"discord_role",name:"discord_role",label:"\u5C0D\u61C9 Discord \u8EAB\u4EFD\u7D44",type:"text",class:B([{"is-invalid":g.discord_role},"form-control"]),placeholder:"ex: Vue \u76F4\u64AD\u73ED 2022 \u6625",rules:"required"},null,8,["modelValue","class"]),l(a,{name:"discord_role",class:"invalid-feedback"})])])]),je,e("div",qe,[Ae,e("button",{type:"submit",class:"btn btn-primary",disabled:!j.valid}," \u78BA\u8A8D\u65B0\u589E ",8,Ee)])]),_:1})]),_:1},512)}}},Ge=H(Pe,[["__scopeId","data-v-bdc21449"]]),Ke={class:"h4 text-dark mb-4"},Oe=e("p",{class:"text-danger mb-2"},"\u8ACB\u6CE8\u610F\uFF01\u522A\u9664\u5F8C\u5C07\u7121\u6CD5\u5FA9\u539F",-1),He={class:"d-flex justify-content-end"},Je=e("button",{type:"button",class:"btn btn-primary me-2","data-bs-dismiss":"modal"}," \u53D6\u6D88 ",-1),Qe={__name:"DeleteTrainingModal",props:{trainingName:{type:String,default:""},trainingId:{type:String,default:""}},emits:["getTrainingList"],setup(m,{expose:I,emit:D}){const k=m,{apiDeleteTraining:o}=E,c=d(null),p=d(null);A(()=>{p.value=new X(c.value.hModal)});const S=()=>{p.value.show()},v=()=>{p.value.hide()},u=async T=>{try{await o(T),h("success","\u6210\u529F\u522A\u9664\u57F9\u8A13\u73ED","\u6210\u529F\u522A\u9664\u57F9\u8A13\u73ED")}catch(_){h("danger","\u522A\u9664\u57F9\u8A13\u73ED\u5931\u6557",`${_.response.data.statusCode}:${_.response.data.message}`)}D("getTrainingList"),v()};return I({openModal:S,hideModal:v}),(T,_)=>(x(),J(W,{ref_key:"modalRef",ref:c,title:"\u662F\u5426\u522A\u9664\u6B64\u76F4\u64AD\u73ED\uFF1F",modalSize:" modal-dialog-centered",classList:"text-dark pb-0","has-footer":!1},{body:b(()=>[e("h5",Ke,V(k.trainingName),1),Oe,e("div",He,[Je,e("button",{type:"submit",class:"btn btn-danger",onClick:_[0]||(_[0]=U=>u(k.trainingId))}," \u522A\u9664\u76F4\u64AD\u73ED ")])]),_:1},512))}};const C=m=>(Y("data-v-91e77943"),m=m(),Z(),m),We={class:"container-fluid px-4 pt-4 pb-6"},Xe=C(()=>e("h1",{class:"fs-4 mb-5"},"\u57F9\u8A13\u73ED\u5217\u8868",-1)),Ye={class:"mb-3"},Ze=C(()=>e("span",{class:"material-icons align-middle"}," add ",-1)),et={class:"mb-5"},tt={class:"table mb-0 text-nowrap align-middle",style:{"font-size":"14px"}},at=C(()=>e("thead",{class:"bg-light"},[e("tr",null,[e("th",{class:"ps-3 py-2 text-muted border-0 w-25"},"\u540D\u7A31"),e("th",{class:"py-2 text-muted border-0",width:"200"},"\u4E0A\u8AB2\u6642\u9593"),e("th",{class:"py-2 text-muted border-0",width:"150"},"\u5831\u540D\u4EBA\u6578"),e("th",{class:"py-2 text-muted border-0 w-50"},"\u4F7F\u7528\u8005\u7FA4\u7D44"),e("th",{class:"py-2 text-muted border-0"})])],-1)),st={class:"ps-3"},nt={class:""},ot=C(()=>e("br",null,null,-1)),lt={class:""},it={class:"scrollbar"},dt={class:"badge text-dark"},rt={class:"pe-3"},ct={class:"dropdown"},ut=C(()=>e("a",{class:"btn btn-outline-primary dropdown-toggle",href:"#",role:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," \u64CD\u4F5C ",-1)),mt={class:"dropdown-menu dropdown-menu-start py-0 overflow-hidden"},pt=C(()=>e("li",null,[e("hr",{class:"dropdown-divider"})],-1)),_t=["onClick"],gt=["onClick"],vt={class:"d-flex flex-wrap justify-content-center"},ft={__name:"TrainingList",setup(m){const{apiGetTrainingList:I,apiPostTrainingDuplicate:D}=E,k=re.useLoading(),o=ce(),c=d({trainingClassesList:[],pagination:{total:10,count:10,total_page:10,current_page:1}}),p=d(""),y=async(n=1)=>{const t=k.show();try{const{training_classes:s,pagination:a}=await I({page:n,name:p.value});c.value.trainingClassesList=s,c.value.pagination=a}catch(s){h("danger","\u53D6\u5F97\u57F9\u8A13\u73ED\u5217\u8868\u5931\u6557",`${s.response.data.statusCode}:${s.response.data.message}`)}finally{t.hide()}};A(y);const S=n=>{y(n)},v=d(!1),u=d(""),T=()=>{u.value?(u.value=u.value.trim(),p.value=`&name=${u.value}`):p.value="",y()},_=d(null),U=()=>{_.value.openModal()},f=d({}),z=d(null),R=n=>{f.value={...n},z.value.openModal()},N=async n=>{const t=k.show();try{const s={training_class_id:n},{training_class:a}=await D(s);await y(),o.push(`/admin/training/${a.id}`)}catch(s){h("danger","\u8907\u88FD\u57F9\u8A13\u73ED\u5931\u6557",`${s.response.data.statusCode}:${s.response.data.message}`)}finally{t.hide()}};return(n,t)=>{const s=F("router-link");return x(),L(q,null,[e("div",We,[Xe,e("div",Ye,[ue(e("input",{onCompositionstart:t[0]||(t[0]=a=>v.value=!0),onCompositionend:t[1]||(t[1]=a=>v.value=!1),"onUpdate:modelValue":t[2]||(t[2]=a=>u.value=a),onKeydown:t[3]||(t[3]=pe($(()=>{v.value||T()},["prevent"]),["enter"])),type:"text",placeholder:"\u641C\u5C0B\u57F9\u8A13\u73ED\u540D\u7A31",class:"form-control w-25"},null,544),[[me,u.value]])]),e("div",{class:"d-flex justify-content-end mb-3"},[e("button",{type:"button",class:"btn btn-primary",onClick:U},[Ze,w(" \u65B0\u589E\u57F9\u8A13\u73ED ")])]),e("div",et,[e("table",tt,[at,e("tbody",null,[(x(!0),L(q,null,O(c.value.trainingClassesList,a=>(x(),L("tr",{key:a.id},[e("td",st,V(a.name),1),e("td",nt,[w(V(new Date(a.start_at).toLocaleDateString("sv-SE")),1),ot,w(V(new Date(a.end_at).toLocaleDateString("sv-SE")),1)]),e("td",lt,V(a.enrollments)+" \u4EBA",1),e("td",it,[(x(!0),L(q,null,O(a.user_groups,i=>(x(),L("div",{class:"mb-1",key:i.id},[l(s,{to:`/admin/users/groups/${i.id}`,onClick:t[4]||(t[4]=$(()=>{},["prevent"])),class:"d-inline-block text-decoration-none me-2"},{default:b(()=>[e("span",dt,V(i.name),1)]),_:2},1032,["to"])]))),128))]),e("td",rt,[e("div",ct,[ut,e("ul",mt,[e("li",null,[l(s,{to:`/admin/training/${a.id}?menuId=1`,onClick:t[5]||(t[5]=$(()=>{},["prevent"])),class:"dropdown-item py-2"},{default:b(()=>[w(" \u4F7F\u7528\u8005\u7FA4\u7D44\u8A2D\u5B9A ")]),_:2},1032,["to"])]),e("li",null,[l(s,{to:`/admin/training/${a.id}?menuId=2`,onClick:t[6]||(t[6]=$(()=>{},["prevent"])),class:"dropdown-item py-2"},{default:b(()=>[w(" \u884C\u4E8B\u66C6\u8A2D\u5B9A ")]),_:2},1032,["to"])]),e("li",null,[l(s,{to:`/admin/training/${a.id}?menuId=3`,onClick:t[7]||(t[7]=$(()=>{},["prevent"])),class:"dropdown-item py-2"},{default:b(()=>[w(" \u9801\u9762\u9078\u55AE\u8A2D\u5B9A ")]),_:2},1032,["to"])]),e("li",null,[l(s,{to:`/admin/training/${a.id}?menuId=4`,onClick:t[8]||(t[8]=$(()=>{},["prevent"])),class:"dropdown-item py-2"},{default:b(()=>[w(" \u8B49\u66F8\u8A2D\u5B9A ")]),_:2},1032,["to"])]),pt,e("li",null,[l(s,{to:`/admin/training/${a.id}`,onClick:t[9]||(t[9]=$(()=>{},["prevent"])),class:"dropdown-item py-2"},{default:b(()=>[w(" \u7DE8\u8F2F ")]),_:2},1032,["to"]),e("button",{type:"button",class:"dropdown-item text-success py-2",onClick:$(i=>N(a.id),["prevent"])}," \u8907\u88FD ",8,_t),e("button",{type:"button",class:"dropdown-item text-danger py-2",onClick:i=>R(a)}," \u522A\u9664 ",8,gt)])])])])]))),128))])])]),e("div",vt,[l(Q(_e),{modelValue:c.value.pagination.current_page,"onUpdate:modelValue":t[10]||(t[10]=a=>c.value.pagination.current_page=a),records:c.value.pagination.total,"per-page":c.value.pagination.count,options:{chunk:6},onPaginate:S},null,8,["modelValue","records","per-page"])])]),l(Ge,{ref_key:"TrainingModalComponentRef",ref:_,onGetTrainingList:y},null,512),l(Qe,{ref_key:"DeleteTrainingModalComponentRef",ref:z,onGetTrainingList:y,"training-name":f.value.name,"training-id":f.value.id},null,8,["training-name","training-id"])],64)}}},wt=H(ft,[["__scopeId","data-v-91e77943"]]);export{wt as default};
