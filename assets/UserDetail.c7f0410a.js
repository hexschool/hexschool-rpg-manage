import{t as ee,r as _,o as O,a as l,e as se,f as F,b as e,g as E,h as v,i as P,M as te,B as ae,j as he,w as B,v as le,_ as q,c as o,k as be,l as W,m as Z,n as ne,p as U,F as A,q as I,d as S,s as fe,x as C,y as oe,L as ie,z as j,A as M,C as Y,u as pe,D as H,E as ge}from"./index.b171e68b.js";import{b as ye}from"./bsTab.22ff94d2.js";import"./tab.ac64535a.js";const ke=["disabled"],$e=["disabled"],we={__name:"ResetPasswordModal",props:{body:{type:Object,default(){return{nickname:String,type:String,userId:String}}}},setup(h,{expose:i}){const a=ee(h,"body"),c=_(null),y=_(null),n=_(!1);O(()=>{y.value=new ae(c.value.hModal),c.value.hModal.addEventListener("hidden.bs.modal",()=>{n.value=!1})});const f=()=>{n.value=!0},k=()=>{y.value.show()},m=()=>{y.value.hide()};return i({openModal:k,hideModal:m}),(p,r)=>(l(),se(te,{ref_key:"resetPasswordModalRef",ref:c,id:"resetPasswordModal","has-footer":!0,title:"\u91CD\u8A2D\u5BC6\u78BC\u4FE1"},{body:F(()=>[e("p",null,[E("\u78BA\u5B9A\u8981\u91CD\u65B0\u767C\u9001\u9A57\u8B49\u4FE1\u7D66 "),e("b",null,v(P(a).nickname),1),E(" \u9019\u500B\u4F7F\u7528\u8005\u55CE\uFF1F")])]),footer:F(()=>[e("button",{type:"button",class:"btn btn-primary",disabled:n.value,onClick:m}," \u53D6\u6D88 ",8,ke),e("button",{type:"button",class:"btn btn-danger",disabled:n.value,onClick:r[0]||(r[0]=$=>{p.$emit("confirm",{type:P(a).type,userId:P(a).userId,nickname:P(a).nickname}),f()})}," \u767C\u9001\u91CD\u8A2D\u5BC6\u78BC\u4FE1 ",8,$e)]),_:1},512))}},xe={class:"mb-0"},Le={for:"email"},Me={class:"text-danger"},Re=["disabled"],Ce={__name:"DangerActionsModal",props:{body:{type:Object,default(){return{userId:String,name:String,email:String,type:String,platformType:String}}}},emits:["danger-user-method"],setup(h,{expose:i,emit:R}){const c=ee(h,"body"),y=_(null),n=_(null),d=_("");O(()=>{y.value=new ae(n.value.hModal),n.value.hModal.addEventListener("hidden.bs.modal",()=>{d.value=""})});const f=he(()=>{const{type:r}=c.value;return r==="verified"?{title:"\u662F\u5426\u767C\u9001\u9A57\u8B49\u4FE1\u4EF6\uFF1F",body:{label:"\u8ACB\u518D\u6B21\u8F38\u5165\u7D81\u5B9A Email \u4EE5\u91CD\u65B0\u767C\u9001\u9A57\u8B49\u4FE1\u4EF6",description:"\u8ACB\u6CE8\u610F\uFF01\u8F49\u70BA\u672A\u9A57\u8B49\u72C0\u614B\u5F8C\uFF0C\u4F7F\u7528\u8005\u9700\u91CD\u65B0\u6536\u9A57\u8B49\u4FE1\u624D\u53EF\u518D\u6B21\u767B\u5165",btn:"\u91CD\u767C\u9A57\u8B49\u4FE1"}}:r==="unverified"?{title:"\u662F\u5426\u8F49\u70BA\u672A\u9A57\u8B49\u72C0\u614B\uFF1F",body:{label:"\u8ACB\u518D\u6B21\u8F38\u5165\u7D81\u5B9A Email \u5C07\u4F7F\u7528\u8005\u8F49\u70BA\u672A\u9A57\u8B49\u72C0\u614B",description:"\u8ACB\u6CE8\u610F\uFF01\u8F49\u70BA\u672A\u9A57\u8B49\u72C0\u614B\u5F8C\uFF0C\u4F7F\u7528\u8005\u9700\u91CD\u65B0\u6536\u9A57\u8B49\u4FE1\u624D\u53EF\u518D\u6B21\u767B\u5165",btn:"\u8F49\u70BA\u672A\u9A57\u8B49"}}:r==="deactivated"?{title:"\u662F\u5426\u505C\u6B0A\u6B64\u4F7F\u7528\u8005\uFF1F",body:{label:"\u8ACB\u518D\u6B21\u8F38\u5165\u7D81\u5B9A Email \u4EE5\u505C\u6B0A\u4F7F\u7528\u8005",description:"\u8ACB\u6CE8\u610F\uFF01\u505C\u6B0A\u5F8C\u4F7F\u7528\u8005\u5C07\u7121\u6CD5\u767B\u5165\u76F4\u81F3\u6062\u5FA9\u6B0A\u9650",btn:"\u505C\u6B0A\u4F7F\u7528\u8005"}}:r==="restore"?{title:"\u662F\u5426\u6062\u5FA9\u4F7F\u7528\u8005\u6B0A\u9650\uFF1F",body:{label:"\u8ACB\u518D\u6B21\u8F38\u5165\u7D81\u5B9A Email \u4EE5\u89E3\u9664\u505C\u6B0A\u4F7F\u7528\u8005",description:"\u8ACB\u6CE8\u610F\uFF01\u6062\u5FA9\u5F8C\u4F7F\u7528\u8005\u5C07\u53EF\u4EE5\u6B63\u5E38\u767B\u5165",btn:"\u89E3\u9664\u505C\u6B0A"}}:r==="deleteAccount"?{title:"\u662F\u5426\u522A\u9664\u6B64\u4F7F\u7528\u8005\uFF1F",body:{label:"\u8ACB\u518D\u6B21\u8F38\u5165\u7D81\u5B9A Email \u4EE5\u522A\u9664\u4F7F\u7528\u8005",description:"\u8ACB\u6CE8\u610F\uFF01\u522A\u9664\u5F8C\u5C07\u7121\u6CD5\u5FA9\u539F",btn:"\u522A\u9664\u4F7F\u7528\u8005"}}:r==="unbindThirdParty"?{title:"\u662F\u5426\u89E3\u9664\u4EE5\u4E0B\u7D81\u5B9A\u7684\u5E33\u6236\uFF1F",body:{label:"\u8ACB\u518D\u6B21\u8F38\u5165\u7D81\u5B9A Email \u4EE5\u89E3\u9664\u7D81\u5B9A",description:"\u8ACB\u6CE8\u610F\uFF01\u89E3\u9664\u5F8C\u9700\u91CD\u65B0\u7D81\u5B9A",btn:"\u89E3\u9664\u7D81\u5B9A"}}:{body:{}}}),k=()=>{y.value.show()},m=()=>{y.value.hide()},p=()=>{const{type:r,userId:$,platformType:w}=c.value;R("danger-user-method",{userId:$,type:r,platformType:w})};return i({openModal:k,hideModal:m}),(r,$)=>(l(),se(te,{id:"userDangerActions",ref_key:"myModal",ref:n,"has-footer":!0,title:P(f).title},{body:F(()=>[e("p",xe,v(P(c).name),1),e("p",null,v(P(c).email),1),e("label",Le,v(P(f).body.label),1),B(e("input",{id:"email","onUpdate:modelValue":$[0]||($[0]=w=>d.value=w),type:"email",class:"form-control",placeholder:"example@gmail.com"},null,512),[[le,d.value]]),e("p",Me,v(P(f).body.description),1)]),footer:F(()=>[e("button",{type:"button",class:"btn btn-primary",onClick:m},"\u53D6\u6D88"),e("button",{disabled:d.value!==P(c).email,type:"button",class:"btn btn-danger",onClick:p},v(P(f).body.btn),9,Re)]),_:1},8,["title"]))}},De={},Pe={class:"row"},Ue=be('<h4 class="mt-4 mb-3">\u4ED8\u6B3E\u7D00\u9304</h4><div class="col-md-6"><div class="card shadow-sm rounded-4 overflow-hidden mb-4"><div class="card-body p-0"><div class="bg-light p-3"><table class="table"><tbody><tr><th scope="row"> \u4F7F\u7528\u8005\u540D\u7A31 </th><td></td></tr><tr><th scope="row"> Email </th><td></td></tr><tr><th scope="row"> \u4ED8\u6B3E\u7E3D\u91D1\u984D </th><td></td></tr><tr><th scope="row"> ID </th><td></td></tr></tbody></table></div><div class="p-3 table-responsive"><table class="table"><thead><tr><th scope="col"> \u5EFA\u7ACB\u6642\u9593 </th><th scope="col"> \u4ED8\u6B3E\u6642\u9593 </th><th scope="col"> \u7E3D\u91D1\u984D </th><th scope="col"> \u4E3B\u8981\u54C1\u9805 </th><th scope="col"> \u67E5\u770B\u7D30\u7BC0 </th></tr></thead><tbody><tr><th scope="row"></th><td></td><td></td><td></td><td></td></tr></tbody></table></div></div></div></div>',2),Ae=[Ue];function Ee(h,i){return l(),o("div",Pe,Ae)}const Ve=q(De,[["render",Ee]]),Ie={name:"UserLog",setup(){const h=W(),i=_(""),R=_(""),a=_(!1),c=Z({log:[],adminLog:[],remarks:[]}),y=_(!0),n=_(!1);function d(x){n.value=!0,S.get(`/v1/user/${x}/log`).then(V=>{c.log=V.data.user_logs,a.value=!1,y.value=!1,n.value=!1})}const f=_(!0),k=_(!1);function m(x){k.value=!0,S.get(`/v1/user/${x}/admin_log`).then(V=>{c.adminLog=V.data.admin_logs,a.value=!1,f.value=!1,k.value=!1})}const p=_(!0),r=_(!1);function $(x){r.value=!0,S.get(`/v1/user/${x}/remark`).then(V=>{c.remarks=V.data.remarks,a.value=!1,p.value=!1,r.value=!1})}function w(){const{id:x}=h.params;a.value=!0,S.post(`/v1/user/${x}/remark`,{remark:R.value}).then(V=>{R.value="",V.data.message==="\u6210\u529F"&&$(x)})}return O(()=>{const{id:x}=h.params;i.value=x}),{PostAmdinRemark:w,remarkBtnDisabled:a,remarkText:R,tempID:i,remarkOverlay:p,remarkLoading:r,userLogOverlay:y,userLogLoading:n,adminLogOverlay:f,adminLogLoading:k,getUserRemark:$,getUserAdminLog:m,getUserLog:d,...ne(c)}}},Te=e("h4",null,"\u7BA1\u7406\u8005\u8A3B\u8A18\u8A0A\u606F",-1),He={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},Se={class:"card-body row"},ze={class:"col-md-6"},Fe={class:"d-flex align-items-end mb-3"},je={class:"flex-fill me-2"},Oe=e("label",{for:"admin_remark",class:"form-label"},"\u8A3B\u8A18\u8A0A\u606F",-1),Be=["disabled"],Ze=e("p",{class:"mb-1"}," \u8A3B\u8A18\u7D00\u9304 ",-1),Ne={class:"p-3 display-12 fw-normal mb-3 overflow-y-auto position-relative rounded-3",style:{"max-height":"200px",height:"150px","background-color":"#EDF0EF"}},qe={key:0,class:"overlay position-absolute d-flex align-items-center justify-content-center",style:{top:"0",bottom:"0",left:"0",right:"0"}},We={key:0,class:"spinner-border spinner-border-sm",role:"status"},Ge=e("span",{class:"visually-hidden"},"Loading...",-1),Je=[Ge],Ke={class:"text-secondary"},Qe=e("hr",null,null,-1),Xe=e("h4",null,"\u7BA1\u7406\u8005\u64CD\u4F5C",-1),Ye={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},es={class:"card-body row"},ss={class:"col-md-6"},ts=e("p",{class:"mb-2"},"\u7BA1\u7406\u64CD\u4F5C\u7D00\u9304",-1),as={class:"p-3 display-12 fw-normal mb-3 overflow-y-auto position-relative rounded-3",style:{"max-height":"200px",height:"150px","background-color":"#EDF0EF"}},ls={key:0,class:"overlay position-absolute d-flex align-items-center justify-content-center",style:{top:"0",bottom:"0",left:"0",right:"0"}},ns={key:0,class:"spinner-border spinner-border-sm",role:"status"},os=e("span",{class:"visually-hidden"},"Loading...",-1),is=[os],ds={class:"text-secondary"},rs=e("hr",null,null,-1),cs=e("h4",null,"\u4F7F\u7528\u8005\u64CD\u4F5C",-1),us={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},ms={class:"card-body row"},_s={class:"col-md-6"},vs=e("p",{class:"mb-2"},"\u4F7F\u7528\u64CD\u4F5C\u7D00\u9304",-1),hs={class:"p-3 display-12 fw-normal mb-3 overflow-y-auto position-relative rounded-3",style:{"max-height":"200px",height:"150px","background-color":"#EDF0EF"}},bs={key:0,class:"overlay position-absolute d-flex align-items-center justify-content-center",style:{top:"0",bottom:"0",left:"0",right:"0"}},fs={key:0,class:"spinner-border spinner-border-sm",role:"status"},ps=e("span",{class:"visually-hidden"},"Loading...",-1),gs=[ps],ys={class:"text-secondary"},ks=e("hr",null,null,-1);function $s(h,i,R,a,c,y){return l(),o(A,null,[Te,e("div",He,[e("div",Se,[e("div",ze,[e("div",Fe,[e("div",je,[Oe,B(e("input",{id:"admin_remark","onUpdate:modelValue":i[0]||(i[0]=n=>a.remarkText=n),type:"text",class:"form-control"},null,512),[[le,a.remarkText]])]),e("button",{type:"button",class:"btn btn-primary ms-auto",disabled:a.remarkBtnDisabled,onClick:i[1]||(i[1]=n=>a.PostAmdinRemark())}," \u5132\u5B58\u8A0A\u606F ",8,Be)]),Ze,e("div",Ne,[a.remarkOverlay?(l(),o("div",qe,[e("button",{class:"btn btn-outline-dark bg-white text-dark",onClick:i[2]||(i[2]=n=>{a.getUserRemark(a.tempID)})},[E(" \u8B80\u53D6\u8A0A\u606F "),a.remarkLoading?(l(),o("div",We,Je)):U("",!0)])])):U("",!0),(l(!0),o(A,null,I(h.remarks,(n,d)=>(l(),o("div",{key:"admin_msg"+d,class:"mb-1"},[e("p",null,[E(v(n.nickname)+" ",1),e("span",Ke,v(new Date(n.create_time).toLocaleString("zh-TW",{year:"numeric",month:"numeric",day:"numeric"})),1)]),e("p",null,v(n.content),1),Qe]))),128))])])])]),Xe,e("div",Ye,[e("div",es,[e("div",ss,[ts,e("div",as,[a.adminLogOverlay?(l(),o("div",ls,[e("button",{class:"btn btn-outline-dark bg-white text-dark",onClick:i[3]||(i[3]=n=>{a.getUserAdminLog(a.tempID)})},[E(" \u8B80\u53D6\u8A0A\u606F "),a.adminLogLoading?(l(),o("div",ns,is)):U("",!0)])])):U("",!0),(l(!0),o(A,null,I(h.adminLog,(n,d)=>(l(),o("div",{key:`user_msg${d}`,class:"mb-1"},[e("p",null,[E(v(n.nickname)+" ",1),e("span",ds,v(new Date(n.create_time).toLocaleString("zh-TW",{year:"numeric",month:"numeric",day:"numeric"})),1)]),e("p",null,v(n.content),1),rs]))),128))])])])]),cs,e("div",us,[e("div",ms,[e("div",_s,[vs,e("div",hs,[a.userLogOverlay?(l(),o("div",bs,[e("button",{class:"btn btn-outline-dark bg-white text-dark",onClick:i[4]||(i[4]=n=>{a.getUserLog(a.tempID)})},[E(" \u8B80\u53D6\u8A0A\u606F "),a.userLogLoading?(l(),o("div",fs,gs)):U("",!0)])])):U("",!0),(l(!0),o(A,null,I(h.log,(n,d)=>(l(),o("div",{key:`user_msg${d}`,class:"mb-1"},[e("p",null,[E(v(n.nickname)+" ",1),e("span",ys,v(new Date(n.create_time).toLocaleString("zh-TW",{year:"numeric",month:"numeric",day:"numeric"})),1)]),e("p",null,v(n.content),1),ks]))),128))])])])])],64)}const ws=q(Ie,[["render",$s]]),xs=e("h4",{class:"mt-4 mb-3"},"\u5DF2\u8A3B\u518A\u8AB2\u7A0B",-1),Ls={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},Ms={class:"card-body"},Rs={class:"row"},Cs={class:"col-md-6"},Ds={class:"mb-3"},Ps={class:"list-unstyled"},Us={class:"text-secondary"},As={__name:"CoursesList",props:{userId:{type:String,default:""}},setup(h){const i=h,{apiGetUserCourses:R}=oe,a=_([]),c=async y=>{try{const{courses:n}=await R(y);a.value=n}catch(n){C("danger","\u53D6\u5F97\u8AB2\u7A0B\u5931\u6557",n)}};return fe(()=>i.userId,y=>{c(y)}),(y,n)=>(l(),o(A,null,[xs,e("div",Ls,[e("div",Ms,[e("div",Rs,[e("div",Cs,[e("h5",Ds,"\u5171 "+v(a.value.length)+" \u9580\u8AB2\u7A0B",1),e("ul",Ps,[(l(!0),o(A,null,I(a.value,(d,f)=>(l(),o("li",{class:"d-flex justify-content-between",key:`${d.title}${f}`},[e("p",null,v(d.title),1),e("p",null,[e("span",Us,v(new Date(d.enrolled_time).toLocaleString("zh-TW",{year:"numeric",month:"numeric",day:"numeric"})),1)])]))),128))])])])])])],64))}},Es={name:"RoleAndPermissions",components:{Loading:ie},setup(){const h=W(),i=_(!1),R=_(!0),a=_(""),c=Z({roleList:[],rangeList:[],userHasRole:[],userHasRanges:[]});function y(){S.get("/v1/permission/roles").then(m=>{c.roleList=m.data.roles,S.get("/v1/permission/ranges").then(p=>{c.rangeList=p.data.ranges})})}function n(m){i.value=!0,c.userHasRole=[],c.userHasRanges=[],S.get(`/v1/users/${m}/permissions`).then(p=>{p.data.roles.forEach(r=>{c.userHasRole.push(r.role_id)}),p.data.ranges.forEach(r=>{r.ranges.forEach($=>{c.userHasRanges.push($.id)})}),i.value=!1}).catch(p=>{i.value=!1,C("danger","\u53D6\u5F97\u4F7F\u7528\u8005\u89D2\u8272\u548C\u6B0A\u9650\u5931\u6557",p)})}function d(m){const p=c.rangeList.filter(r=>r.name===m.target.id);m.target.checked?p[0].sub_ranges.forEach(r=>{c.userHasRanges.some($=>$===r.id)||(c.userHasRanges=c.userHasRanges.concat([r.id]))}):p[0].sub_ranges.forEach(r=>{c.userHasRanges=c.userHasRanges.filter($=>$!==r.id)})}const f=_(!1);function k(m,p){f.value=!0;const r=`/v1/users/${a.value}/permission/${m}`,$={};$[m]=p,S.put(r,$).then(w=>{w.data.message==="\u6210\u529F"?C("success",`\u7DE8\u8F2F ${m} \u6210\u529F`,`\u7DE8\u8F2F ${m} \u6210\u529F`):C("danger",`\u7DE8\u8F2F ${m} \u5931\u6557`,w.data.message),f.value=!1,n(a.value)}).catch(w=>{f.value=!1,C("danger",`\u7DE8\u8F2F ${m} \u5931\u6557`,w)})}return O(()=>{const{id:m}=h.params;y(),n(m),a.value=m}),{CheckAllRoles:d,...ne(c),update:k,isLoading:i,fullPage:R,btnDisabled:f}}},Vs={class:"row"},Is=e("h4",{class:"mt-5 mb-3"},"\u500B\u4EBA\u8CC7\u8A0A",-1),Ts={class:"col-md-6"},Hs={class:"card shadow-sm rounded-4 overflow-hidden mb-4 position-relative"},Ss={class:"card-body"},zs=["id","value"],Fs=["for"],js=e("hr",{class:"my-4"},null,-1),Os=["disabled"],Bs={class:"row"},Zs=e("h4",{class:"mt-4 mb-3"},"\u55AE\u4E00\u6B0A\u9650",-1),Ns={class:"col-md-6"},qs={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},Ws={class:"card-body"},Gs={class:"list-unstyled overflow-y-auto",style:{"max-height":"350px"}},Js={class:"form-check"},Ks=["id","checked"],Qs=["for"],Xs={class:"list-unstyled ms-4"},Ys=["id","value"],et=["for"],st=e("hr",null,null,-1),tt=["disabled"];function at(h,i,R,a,c,y){const n=j("loading");return l(),o(A,null,[M(n,{active:a.isLoading,"is-full-page":a.fullPage},null,8,["active","is-full-page"]),e("div",Vs,[Is,e("div",Ts,[e("div",Hs,[e("div",Ss,[(l(!0),o(A,null,I(h.roleList,d=>(l(),o("div",{key:d.id,class:"form-check form-switch"},[B(e("input",{id:"c_"+d.id,"onUpdate:modelValue":i[0]||(i[0]=f=>h.userHasRole=f),class:"form-check-input",type:"checkbox",value:d.id},null,8,zs),[[Y,h.userHasRole]]),e("label",{class:"form-check-label",for:"c_"+d.id},v(d.cht_name),9,Fs)]))),128)),js,e("button",{type:"button",class:"btn btn-sm btn-primary",disabled:a.btnDisabled,onClick:i[1]||(i[1]=d=>a.update("roles",h.userHasRole))}," \u5132\u5B58\u8B8A\u66F4 ",8,Os)])])])]),e("div",Bs,[Zs,e("div",Ns,[e("div",qs,[e("div",Ws,[e("ul",Gs,[(l(!0),o(A,null,I(h.rangeList,(d,f)=>(l(),o("li",{key:"range"+f},[e("div",Js,[e("input",{id:d.name,class:"form-check-input",type:"checkbox",checked:d.sub_ranges.every(k=>h.userHasRanges.includes(k.id)),onChange:i[2]||(i[2]=(...k)=>a.CheckAllRoles&&a.CheckAllRoles(...k))},null,40,Ks),e("label",{class:"form-check-label",for:d.name},v(d.cht_name),9,Qs)]),e("ul",Xs,[e("li",null,[(l(!0),o(A,null,I(d.sub_ranges,(k,m)=>(l(),o("div",{key:"sub"+k.id+m,class:"form-check"},[B(e("input",{id:"sub"+k.id,"onUpdate:modelValue":i[3]||(i[3]=p=>h.userHasRanges=p),class:"form-check-input",type:"checkbox",value:k.id},null,8,Ys),[[Y,h.userHasRanges]]),e("label",{class:"form-check-label",for:"sub"+k.id},v(k.cht_name),9,et)]))),128))])])]))),128))]),st,e("button",{type:"button",class:"btn btn-sm btn-primary",disabled:a.btnDisabled,onClick:i[4]||(i[4]=d=>a.update("ranges",h.userHasRanges))}," \u5132\u5B58\u8B8A\u66F4 ",8,tt)])])])])],64)}const lt=q(Es,[["render",at]]),nt={class:"about px-4 mt-4"},ot=e("p",null,[e("span",{class:"material-icons align-bottom"},"arrow_back"),E("\u8FD4\u56DE")],-1),it={key:0,class:"alert alert-danger",role:"alert"},dt=e("p",{class:"mb-0"},[e("span",{class:"material-icons align-bottom"}," info "),E(" \u6B64\u4F7F\u7528\u8005\u5DF2\u88AB\u505C\u6B0A\u3002\u82E5\u9700\u89E3\u9664\uFF0C\u8ACB\u5230\u5371\u96AA\u64CD\u4F5C\u5340\u57DF\u9032\u884C\u64CD\u4F5C ")],-1),rt=[dt],ct={class:"row position-relative align-items-start"},ut={class:"col-xl-5 col-md-8"},mt={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},_t={class:"card-body bg-white py-3 d-flex align-items-center"},vt=["src"],ht={key:1,style:{width:"60px",height:"60px"},class:"rounded-circle mx-auto bg-light mb-1"},bt={class:"ms-2"},ft={class:"mb-0"},pt={class:"mb-0"},gt={class:"col-md-12"},yt={class:"nav nav-tabs",role:"tablist"},kt=["id","aria-controls","data-bs-target","onClick"],$t={class:"tab-content",id:"myTabContent"},wt={class:"tab-pane fade show active",id:"users",role:"tabpanel","aria-labelledby":"users-tab"},xt=e("h4",{class:"mt-5 mb-3"},"\u500B\u4EBA\u8CC7\u8A0A",-1),Lt={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},Mt={class:"card-body"},Rt={class:"row mb-3"},Ct={class:"col-md-6"},Dt=e("label",{for:"nickname",class:"form-label"},"\u66B1\u7A31*",-1),Pt={class:"row mb-3"},Ut={class:"col-xl-3 col-md-6"},At=e("label",{for:"last_name",class:"form-label"},"\u4F7F\u7528\u8005\u59D3\u6C0F",-1),Et={class:"col-xl-3 col-md-6"},Vt=e("label",{for:"first_name",class:"form-label"},"\u4F7F\u7528\u8005\u540D\u5B57",-1),It={class:"row mb-3"},Tt={class:"col-md-6"},Ht=e("label",{for:"email",class:"form-label"},[E("Email"),e("span",{class:"text-danger ms-2"},[e("small",null,"*\u4E0D\u5F97\u4FEE\u6539")])],-1),St=["value"],zt={class:"col-md-6"},Ft=e("label",{for:"secondary-email",class:"form-label"},"\u6B21\u8981 Email",-1),jt=["value"],Ot=e("p",{class:"mb-1"},"\u9A57\u8B49\u72C0\u614B",-1),Bt={class:"mb-3"},Zt={class:"d-inline-flex align-items-center border border-light p-1 px-2 rounded-2 bg-light"},Nt={key:0,class:"material-icons text-primary"},qt={key:1,class:"material-icons-outlined text-danger"},Wt={key:2},Gt={class:"my-0"},Jt={class:"row"},Kt={class:"col-md-6"},Qt=e("label",{for:"password",class:"form-label"},"\u91CD\u8A2D\u5BC6\u78BC",-1),Xt=e("hr",{class:"my-4"},null,-1),Yt=["disabled"],ea=e("h4",{class:"mb-3"},"\u540C\u6B65\u5E33\u865F",-1),sa={class:"col-md-6"},ta={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},aa={class:"card-body d-flex align-items-center justify-content-between"},la={class:"list-unstyled"},na=["onClick"],oa={key:1,class:"row"},ia=e("div",{class:"col-md-6"},[e("div",{class:"card shadow-sm rounded-4 overflow-hidden mb-3"},[e("div",{class:"card-body d-flex align-items-center justify-content-between"},[e("p",{class:"mb-0"},"\u5C1A\u672A\u540C\u6B65\u4EFB\u4F55\u5E33\u865F\u3002")])])],-1),da=[ia],ra={class:"tab-pane fade",id:"roles",role:"tabpanel","aria-labelledby":"roles-tab"},ca={class:"tab-pane fade",id:"courses",role:"tabpanel","aria-labelledby":"courses-tab"},ua={class:"tab-pane fade",id:"orders",role:"tabpanel","aria-labelledby":"orders-tab"},ma={class:"tab-pane fade",id:"danger",role:"tabpanel","aria-labelledby":"danger-tab"},_a=e("h4",{class:"mt-4 mb-3"},"\u5371\u96AA\u64CD\u4F5C",-1),va={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},ha={class:"card-body"},ba={key:0,class:"d-flex align-items-center"},fa=e("div",{class:"flex-fill"},[e("h5",null,"\u6062\u5FA9\u4F7F\u7528\u8005\u6B0A\u9650"),e("p",{class:"text-muted mb-0"},"\u6062\u5FA9\u6B64\u4F7F\u7528\u8005\u7684\u767B\u5165\u6B0A\u9650")],-1),pa={key:1,class:"d-flex align-items-center"},ga=e("div",{class:"flex-fill"},[e("h5",null,"\u505C\u6B0A\u4F7F\u7528\u8005"),e("p",{class:"text-muted mb-0"}," \u505C\u6B0A\u5F8C\u4F7F\u7528\u8005\u5C07\u7121\u6CD5\u767B\u5165\u76F4\u5230\u6062\u5FA9\u6B0A\u9650 ")],-1),ya=e("hr",null,null,-1),ka={class:"d-flex align-items-center"},$a=e("div",{class:"flex-fill"},[e("h5",null,"\u8F49\u70BA\u672A\u9A57\u8B49\u72C0\u614B"),e("p",{class:"text-muted mb-0"}," \u8F49\u70BA\u672A\u9A57\u8B49\u72C0\u614B\u5F8C\uFF0C\u4F7F\u7528\u8005\u9700\u91CD\u65B0\u6536\u9A57\u8B49\u4FE1\u624D\u53EF\u518D\u6B21\u767B\u5165 ")],-1),wa=e("hr",null,null,-1),xa={class:"d-flex align-items-center"},La=e("div",{class:"flex-fill"},[e("h5",null,"\u91CD\u767C\u9A57\u8B49\u4FE1\u4EF6"),e("p",{class:"text-muted mb-0"}," \u8F49\u70BA\u672A\u9A57\u8B49\u72C0\u614B\u5F8C\uFF0C\u4F7F\u7528\u8005\u9700\u91CD\u65B0\u6536\u9A57\u8B49\u4FE1\u624D\u53EF\u518D\u6B21\u767B\u5165 ")],-1),Ma=e("hr",null,null,-1),Ra={class:"d-flex align-items-center"},Ca=e("div",{class:"flex-fill"},[e("h5",null,"\u522A\u9664\u4F7F\u7528\u8005"),e("p",{class:"text-muted mb-0"}," \u5C07\u522A\u9664\u4E00\u5207\u4F7F\u7528\u8005\u8CC7\u8A0A\uFF0C\u8ACB\u518D\u4E09\u78BA\u8A8D\uFF01 ")],-1),Ea={__name:"UserDetail",setup(h){const{apiGetUserInfo:i,apiPostUserResetPassword:R,apiDeleteUser:a,apiPutUserSuspend:c,apiPutUserSuspendRestore:y,apiPutUserInfo:n,apiPutUserUnverify:d,apiPostUserVerifyMail:f,apiDeleteUserThirdPartyPlatform:k}=oe,m=W(),p=pe(),r=_(!1),$=_(!0),w=_(null),x=_(null),V=Z([]),G=Z([{id:"users-tab",name:"\u4F7F\u7528\u8005\u8CC7\u6599",target:"users",active:!0,danger:!1,element:null},{id:"roles-tab",name:"\u6B0A\u9650\u7BA1\u7406",target:"roles",active:!1,danger:!1,element:null},{id:"courses-tab",name:"\u5DF2\u8A3B\u518A\u8AB2\u7A0B",target:"courses",active:!1,danger:!1,element:null},{id:"orders-tab",name:"\u8A02\u55AE\u8CC7\u8A0A",target:"orders",active:!1,danger:!1,element:null},{id:"danger-role",name:"\u5371\u96AA\u64CD\u4F5C",target:"danger",active:!1,danger:!0,element:null}]),J={thirdparty:[]},t=_({...J}),g=_({}),K=async b=>{try{const{user_info:s}=await i(b);t.value=s,t.value.first_name&&t.value.first_name!==""&&(g.value.first_name=t.value.first_name),t.value.last_name&&t.value.last_name!==""&&(g.value.last_name=t.value.last_name),g.value.nickname=t.value.nickname}catch(s){C("error",s.message)}finally{r.value=!1}},Q=_({type:"",nickname:"",userId:""}),de=({type:b,nickname:s,userId:L})=>{w.value.openModal(),Q.value={type:b,nickname:s,userId:L}},re=async(b,s)=>{try{await R(b),w.value.hideModal(),C("success","\u5DF2\u5BC4\u51FA\u91CD\u8A2D\u5BC6\u78BC\u4FE1\u4EF6",`${s} \u7684\u91CD\u8A2D\u5BC6\u78BC\u4FE1\u4EF6\u5DF2\u7D93\u6210\u529F\u5BC4\u51FA\u3002`)}catch(L){w.value.hideModal(),C("danger","\u91CD\u8A2D\u5BC6\u78BC\u4FE1\u4EF6\u5BC4\u51FA\u5931\u6557",L)}},ce=({type:b,userId:s,nickname:L})=>{b==="resetPassword"&&re(s,L)},X=_({}),z=({userId:b,type:s,name:L,email:T,platformType:N})=>{x.value.openModal(),X.value={userId:b,type:s,name:L,email:T,platformType:N}},ue=async({userId:b,platformType:s})=>{try{await k(b,s)}catch(L){C("danger","\u89E3\u9664\u7D81\u5B9A\u5931\u6557",L)}},me=async({userId:b,type:s,platformType:L})=>{try{r.value=!0,s==="deleteAccount"?await a(b):s==="deactivated"?await c(b):s==="restore"?await y(b):s==="unverified"?await d(b):s==="verified"?await f(b):s==="unbindThirdParty"&&await ue({userId:b,platformType:L}),x.value.hideModal(),C("success","\u5371\u96AA\u64CD\u4F5C\u6210\u529F\uFF0C3 \u79D2\u5F8C\u8DF3\u56DE\u4F7F\u7528\u8005\u5217\u8868",`\u4F7F\u7528\u8005\u5DF2\u7D93\u88AB ${s} \u4E86\u3002`),setTimeout(()=>{p.push("/admin/users")},3e3)}catch(T){x.value.hideModal(),C("danger","\u5371\u96AA\u64CD\u4F5C\u5931\u6557\uFF0C\u8ACB\u91CD\u65B0\u64CD\u4F5C",T)}finally{r.value=!1}},_e=async b=>{try{r.value=!0;const s={nickname:g.value.nickname};g.value.password&&(s.password=g.value.password),g.value.last_name&&(s.last_name=g.value.last_name.replaceAll(/\s/g,"")),g.value.first_name&&(s.first_name=g.value.first_name.replaceAll(/\s/g,""));const{message:L}=await n(b,s);Object.assign(t,J),C("success","\u66F4\u65B0\u4F7F\u7528\u8005\u8A0A\u606F\u6210\u529F",L),K(b)}catch(s){C("danger","\u66F4\u65B0\u4F7F\u7528\u8005\u8A0A\u606F\u5931\u6557",s)}finally{g.value.password=""}};return O(()=>{const{id:b}=m.params;K(b),ye(V,G)}),(b,s)=>{const L=j("router-link"),T=j("Field"),N=j("ErrorMessage"),ve=j("VForm");return l(),o("div",nt,[M(P(ie),{active:r.value,"is-full-page":$.value,"z-index":1021},null,8,["active","is-full-page"]),M(L,{to:"/admin/users"},{default:F(()=>[ot]),_:1}),t.value.state_name==="lock"?(l(),o("div",it,rt)):U("",!0),e("div",ct,[e("div",ut,[e("div",mt,[e("div",_t,[e("div",null,[t.value.avatar?(l(),o("img",{key:0,src:t.value.avatar,style:{width:"80px",height:"80px"},class:"rounded-circle mx-auto my-2 d-block",alt:"\u982D\u50CF"},null,8,vt)):(l(),o("div",ht))]),e("div",bt,[e("p",ft,v(t.value.nickname?t.value.nickname:`${t.value.last_name}${t.value.first_name}`),1),e("p",pt,v(t.value.email?t.value.email:"\u5C1A\u672A\u7D81\u5B9A Email"),1)])])])]),e("div",gt,[e("ul",yt,[(l(!0),o(A,null,I(G,u=>(l(),o("li",{class:"nav-item",role:"presentation",key:u.id},[e("button",{class:H(["nav-link border",{active:u.active,"text-danger bg-danger bg-opacity-10":u.danger}]),id:u.id,type:"button",role:"tab","aria-controls":u.id,"aria-selected":"true","data-bs-target":`#${u.target}`,ref_for:!0,ref:D=>V.push(D),onClick:ge(D=>u.element.show(),["prevent"])},v(u.name),11,kt)]))),128))]),e("div",$t,[e("div",wt,[xt,e("div",Lt,[e("div",Mt,[M(ve,{onSubmit:s[5]||(s[5]=u=>_e(t.value.user_id))},{default:F(({errors:u})=>[e("div",Rt,[e("div",Ct,[Dt,M(T,{id:"nickname",modelValue:g.value.nickname,"onUpdate:modelValue":s[0]||(s[0]=D=>g.value.nickname=D),name:"nickname",type:"text",class:H(["form-control",{"is-invalid":u.nickname}]),rules:{required:!0,regex:/^[a-zA-Z0-9\u4e00-\u9fa5_-][a-zA-Z0-9 \u4e00-\u9fa5_-]{0,18}[a-zA-Z0-9\u4e00-\u9fa5_-]$/}},null,8,["modelValue","class"]),u.nickname?(l(),o("span",{key:0,role:"alert",class:H({"invalid-feedback":u.nickname})}," \u66B1\u7A31\u7684\u683C\u5F0F\u932F\u8AA4\u3002\u8ACB\u4F7F\u7528\u5927\u5C0F\u5BEB\u82F1\u6587\u3001\u4E2D\u6587\u5B57\uFF0C\u7B26\u865F\u50C5\u63A5\u53D7 - _ \u548C\u7A7A\u683C\uFF0C\u6700\u9577 20 \u500B\u5B57",2)):U("",!0)])]),e("div",Pt,[e("div",Ut,[At,M(T,{id:"last_name",modelValue:g.value.last_name,"onUpdate:modelValue":s[1]||(s[1]=D=>g.value.last_name=D),name:"last_name",type:"text",class:H(["form-control",{"is-invalid":u.last_name}]),rules:{required:!1,regex:g.value.last_name?/^[a-zA-Z0-9\u4e00-\u9fa5_-][a-zA-Z0-9\u4e00-\u9fa5_-]{0,11}$/:""}},null,8,["modelValue","class","rules"]),u.last_name?(l(),o("span",{key:0,role:"alert",class:H({"invalid-feedback":u.last_name})}," \u4F7F\u7528\u8005\u59D3\u6C0F\u7684\u683C\u5F0F\u932F\u8AA4\u3002\u8ACB\u4F7F\u7528\u5927\u5C0F\u5BEB\u82F1\u6587\u3001\u4E2D\u6587\u5B57\uFF0C\u4E0D\u80FD\u6709\u7A7A\u683C\uFF0C\u7B26\u865F\u50C5\u63A5\u53D7 - _\uFF0C\u6700\u9577 12 \u500B\u5B57",2)):U("",!0)]),e("div",Et,[Vt,M(T,{id:"first_name",modelValue:g.value.first_name,"onUpdate:modelValue":s[2]||(s[2]=D=>g.value.first_name=D),name:"first_name",type:"text",class:H(["form-control",{"is-invalid":u.first_name}]),rules:{required:!1,regex:g.value.first_name?/^[a-zA-Z0-9\u4e00-\u9fa5_-][a-zA-Z0-9\u4e00-\u9fa5_-]{0,11}$/:""}},null,8,["modelValue","class","rules"]),u.first_name?(l(),o("span",{key:0,role:"alert",class:H({"invalid-feedback":u.first_name})}," \u4F7F\u7528\u8005\u540D\u5B57\u7684\u683C\u5F0F\u932F\u8AA4\u3002\u8ACB\u4F7F\u7528\u5927\u5C0F\u5BEB\u82F1\u6587\u3001\u4E2D\u6587\u5B57\uFF0C\u4E0D\u80FD\u6709\u7A7A\u683C\uFF0C\u7B26\u865F\u50C5\u63A5\u53D7 - _\uFF0C\u6700\u9577 12 \u500B\u5B57",2)):U("",!0)])]),e("div",It,[e("div",Tt,[Ht,e("input",{id:"email",type:"text",class:"form-control",value:t.value.email,disabled:""},null,8,St)]),e("div",zt,[Ft,e("input",{id:"secondary-email",type:"text",class:"form-control",value:t.value.secondary_email,disabled:""},null,8,jt)])]),e("div",null,[Ot,e("div",Bt,[e("div",Zt,[t.value.state_name==="verified"?(l(),o("span",Nt,"check_circle")):t.value.state_name==="lock"?(l(),o("span",qt,"remove_circle")):(l(),o("span",Wt)),e("p",Gt,v(t.value.state_cht_name),1)])])]),e("div",Jt,[e("div",Kt,[Qt,M(T,{id:"password",modelValue:g.value.password,"onUpdate:modelValue":s[3]||(s[3]=D=>g.value.password=D),name:"password",type:"password",class:H(["form-control",{"is-invalid":u.password}]),rules:{regex:g.value.password?/^.*(?=.{8,})(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).*$/:""}},null,8,["modelValue","class","rules"]),M(N,{name:"password",class:"invalid-feedback"}),e("button",{type:"button",class:"btn btn-sm btn-outline-dark mt-2",onClick:s[4]||(s[4]=D=>de({type:"resetPassword",nickname:t.value.nickname,userId:t.value.user_id}))}," \u767C\u9001\u91CD\u8A2D\u5BC6\u78BC\u4FE1 ")])]),Xt,e("button",{type:"submit",class:"btn btn-primary",disabled:Object.keys(u).length>0}," \u5132\u5B58 ",8,Yt)]),_:1})])]),ea,t.value.thirdparty.length?(l(!0),o(A,{key:0},I(t.value.thirdparty,u=>(l(),o("div",{class:"row",key:u.id},[e("div",sa,[e("div",ta,[e("div",aa,[e("div",null,[e("h5",null,v(u.platform),1),e("ul",la,[e("li",null,v(u.email),1),e("li",null,v(u.nickname),1)])]),e("div",null,[e("button",{type:"button",class:"btn btn-primary",onClick:D=>z({userId:t.value.user_id,type:"unbindThirdParty",name:t.value.nickname,email:t.value.email,platformType:u.platform})}," \u89E3\u9664\u7D81\u5B9A ",8,na)])])])])]))),128)):(l(),o("div",oa,da)),M(ws)]),e("div",ra,[M(lt)]),e("div",ca,[M(As,{"user-id":t.value.user_id},null,8,["user-id"])]),e("div",ua,[M(Ve)]),e("div",ma,[_a,e("div",va,[e("div",ha,[t.value.state_name==="lock"?(l(),o("div",ba,[fa,e("button",{type:"button",class:"btn btn-outline-dark",onClick:s[6]||(s[6]=u=>z({userId:t.value.user_id,type:"restore",name:t.value.nickname,email:t.value.email}))}," \u89E3\u9664\u505C\u6B0A ")])):U("",!0),t.value.state_name!=="lock"?(l(),o("div",pa,[ga,e("div",null,[e("button",{type:"button",class:"btn btn-primary",onClick:s[7]||(s[7]=u=>z({userId:t.value.user_id,type:"deactivated",name:t.value.nickname,email:t.value.email}))}," \u505C\u6B0A\u4F7F\u7528\u8005 ")])])):U("",!0),ya,e("div",ka,[$a,e("div",null,[e("button",{onClick:s[8]||(s[8]=u=>z({userId:t.value.user_id,type:"unverified",name:t.value.nickname,email:t.value.email})),type:"button",class:"btn btn-primary"}," \u8F49\u70BA\u672A\u9A57\u8B49 ")])]),wa,e("div",xa,[La,e("div",null,[e("button",{type:"button",class:"btn btn-primary",onClick:s[9]||(s[9]=u=>z({userId:t.value.user_id,type:"verified",name:t.value.nickname,email:t.value.email}))}," \u91CD\u767C\u9A57\u8B49\u4FE1 ")])]),Ma,e("div",Ra,[Ca,e("div",null,[e("button",{type:"button",class:"btn btn-danger",onClick:s[10]||(s[10]=u=>z({userId:t.value.user_id,type:"deleteAccount",name:t.value.nickname,email:t.value.email}))}," \u522A\u9664\u4F7F\u7528\u8005 ")])])])])])])])]),M(we,{ref_key:"resetPasswordRef",ref:w,body:Q.value,onConfirm:ce},null,8,["body"]),M(Ce,{ref_key:"dangerActionsModalRef",ref:x,body:X.value,onDangerUserMethod:me},null,8,["body"])])}}};export{Ea as default};
