import{l as le,r as o,s as he,o as S,z as U,a as r,e as ne,f as k,A as u,b as e,D as Z,c as d,h as p,g as K,F,q as E,p as Q,M as re,i as M,y as de,t as fe,B as ie,j as ge,w as H,v as ce,N as ye,Q as ke,O as we,x as v,C as xe,E as oe,P as Me}from"./index.b171e68b.js";import{B as Ue}from"./tab.ac64535a.js";const $e={class:"mb-3"},Ce=e("label",{for:"exportByO",class:"form-label"},"\u5927\u91CF\u4F7F\u7528\u8005\u532F\u5165",-1),Ve=e("div",{class:"p-2 bg-light rounded mb-2"},[e("p",{class:"text-muted mb-0"},[e("small",null," \u7BC4\u4F8B\u683C\u5F0F\uFF1Atest@gmail.com, test1@gmail.com ")])],-1),Ge={key:0,class:"bg-light p-2 rounded"},Ie={class:"text-danger"},De=["disabled"],Be={__name:"CreateUsersModal",props:{tempUsers:{type:Object,default(){return{}}}},emits:["createUsersMethod"],setup(j,{expose:B,emit:$}){const L=j,{apiPostUserImport:f}=de,g=le(),y=o(),w=o({});he(()=>L.tempUsers.name,()=>{w.value=L.tempUsers});const h=o(""),_=()=>h.value.split(/[\n,\s]+/),n=o({}),C=async b=>{try{const i={user_emails:_()},c=await f(b,i),{total:V,failed:G,failed_message:I}=c.result;n.value={total:V,failed:G,failedMessage:I},$("createUsersMethod",{target:"import",type:"\u6210\u529F"}),y.value.resetForm()}catch(i){$("createUsersMethod",{target:"import",type:"\u5931\u6557",error:`${i.response.data.statusCode}:${i.response.data.message}`})}},m=o(null);return S(()=>{m.value.hModal.addEventListener("hidden.bs.modal",()=>{n.value={}})}),B({createUsersModalRef:m}),(b,i)=>{const c=U("Field"),V=U("ErrorMessage"),G=U("VForm");return r(),ne(G,{ref_key:"refs",ref:y,onSubmit:i[1]||(i[1]=I=>C(M(g).params.id))},{default:k(({errors:I,meta:A})=>[u(re,{ref_key:"createUsersModalRef",ref:m,"has-footer":!0,title:"\u532F\u5165\u4F7F\u7528\u8005","class-list":""},{body:k(()=>{var O;return[e("div",$e,[Ce,Ve,u(c,{as:"textarea",id:"exportByOne",modelValue:h.value,"onUpdate:modelValue":i[0]||(i[0]=x=>h.value=x),name:"exportByOne",label:"\u5927\u91CF\u4F7F\u7528\u8005\u532F\u5165",type:"text",class:Z(["form-control",{"is-invalid":I.exportByOne}])},null,8,["modelValue","class"]),u(V,{name:"exportByOne",class:"invalid-feedback"})]),(O=n.value)!=null&&O.failed?(r(),d("div",Ge,[e("p",null,[e("small",null,"\u5171\u532F\u5165 "+p(n.value.total)+" \u4F4D",1),K("\uFF0C"),e("small",Ie,"\u5931\u6557 "+p(n.value.failed)+" \u4F4D",1)]),(r(!0),d(F,null,E(n.value.failedMessage,(x,J)=>(r(),d("ul",{key:J},[e("li",null,[e("small",null,p(x.email)+" : "+p(x.message),1)])]))),128))])):Q("",!0)]}),footer:k(()=>[e("button",{type:"submit",disabled:!A.valid,class:"btn btn-primary"}," \u532F\u5165 ",8,De)]),_:2},1536)]),_:1},512)}}},Le={class:"mb-4"},Te={for:"title"},Fe=["disabled"],Ee={__name:"DangerActionsModal",props:{body:{type:Object,default(){return{userId:String,name:String,type:String}}}},emits:["danger-user-method"],setup(j,{expose:B,emit:$}){const f=fe(j,"body"),g=o(""),y=o(null),w=o(null);S(()=>{y.value=new ie(w.value.hModal),w.value.hModal.addEventListener("hidden.bs.modal",()=>{g.value=""})});const h=ge(()=>{const{type:m}=f.value;return m==="deleteUserGroupIdUser"?{title:"\u662F\u5426\u522A\u9664\u6B64\u4F7F\u7528\u8005\u7FA4\u7D44\u4E0B\u7684\u5B78\u751F\uFF1F",body:{label:"\u8ACB\u518D\u6B21\u8F38\u5165\u5B78\u751F\u540D\u7A31",btn:"\u522A\u9664"}}:{body:{}}}),_=()=>{y.value.show()},n=()=>{y.value.hide()},C=()=>{const{type:m,userId:b}=f.value;$("danger-user-method",{userId:b,type:m})};return B({openModal:_,hideModal:n}),(m,b)=>(r(),ne(re,{id:"userDangerActions",ref_key:"myModal",ref:w,"has-footer":!0,title:M(h).title},{body:k(()=>[e("p",Le,p(M(f).name),1),e("label",Te,p(M(h).body.label),1),H(e("input",{id:"title","onUpdate:modelValue":b[0]||(b[0]=i=>g.value=i),type:"text",class:"form-control"},null,512),[[ce,g.value]])]),footer:k(()=>[e("button",{type:"button",class:"btn btn-primary",onClick:n},"\u53D6\u6D88"),e("button",{disabled:g.value!==M(f).name,type:"button",class:"btn btn-danger",onClick:C},p(M(h).body.btn),9,Fe)]),_:1},8,["title"]))}},Se={class:"about px-4 mt-4"},je={class:"border-bottom border-light pb-2 mb-4"},Ae={"aria-label":"breadcrumb"},Oe={class:"breadcrumb"},Re={class:"breadcrumb-item"},Ne=e("li",{class:"breadcrumb-item active","aria-current":"page"}," \u7DE8\u8F2F\u4F7F\u7528\u8005\u7FA4\u7D44 ",-1),Pe={class:"d-flex justify-content-between align-items-center"},qe=e("h1",{class:"fs-4 mb-0"},"\u7DE8\u8F2F\u4F7F\u7528\u8005\u7FA4\u7D44",-1),ze={class:"row mb-4"},Ke={class:"col-md-6"},Qe={class:"card shadow-sm rounded-4 overflow-hidden"},He=e("div",{class:"card-header bg-white py-3"},[e("h2",{class:"fs-6 mb-0 lh-base"},"\u4F7F\u7528\u8005\u7FA4\u7D44")],-1),Je={class:"card-body"},We={class:"mb-3"},Xe=e("label",{for:"name",class:"form-label"},"\u540D\u7A31",-1),Ye={class:"mb-3"},Ze=e("label",{for:"enName",class:"form-label"},"\u82F1\u6587\u540D\u7A31",-1),et={class:"form-check"},tt=e("label",{class:"form-check-label",for:"flexCheckChecked"}," \u662F\u5426\u986F\u793A ",-1),st={class:"card-footer bg-white py-3 d-flex justify-content-end"},at=["disabled"],ot={class:"col-md-6"},lt={class:"card shadow-sm rounded-4 overflow-hidden h-100"},nt={class:"card-header bg-white py-2 d-flex align-items-center justify-content-between"},rt=e("h2",{class:"h6 mb-0 lh-base"},"\u5DF2\u4F7F\u7528\u670D\u52D9",-1),dt={class:"nav nav-pills",id:"pills-tab",role:"tablist"},it={class:"nav-item",role:"presentation"},ct={class:"nav-item",role:"presentation"},ut={class:"nav-item",role:"presentation"},pt={class:"card-body",style:{"max-height":"230px","overflow-y":"scroll"}},mt={class:"tab-content",id:"pills-tabContent"},bt={class:"tab-pane fade show active",id:"pills-home",role:"tabpanel","aria-labelledby":"pills-home-tab",tabindex:"0"},vt={class:"mb-2"},_t={class:"tab-pane fade",id:"pills-profile",role:"tabpanel","aria-labelledby":"pills-profile-tab",tabindex:"0"},ht={class:"tab-pane fade",id:"pills-contact",role:"tabpanel","aria-labelledby":"pills-contact-tab",tabindex:"0"},ft={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},gt={class:"card-header bg-white py-3 d-flex justify-content-between align-items-center"},yt=e("h2",{class:"fs-6 mb-0"},"\u5B78\u751F\u540D\u55AE",-1),kt={class:"row align-items-center"},wt={class:"col-6 d-flex align-items-center"},xt=e("label",{for:"filter",class:"form-label text-secondary w-50 mb-0"},[e("small",null,"\u641C\u5C0B:")],-1),Mt=e("option",{value:""},"\u5168\u90E8",-1),Ut=e("option",{selected:"",value:"email"},"Email",-1),$t=e("option",{value:"nickname"},"\u66B1\u7A31",-1),Ct=[Mt,Ut,$t],Vt={class:"col-6"},Gt={class:"input-group align-items-center"},It=e("div",{class:"bg-white border-0"},[e("span",{class:"material-icons fs-6 align-middle"}," search ")],-1),Dt={class:"card-body",style:{"max-height":"250px",overflow:"auto"}},Bt={class:"display-12 fw-normal mb-3 position-relative rounded-3"},Lt={class:"table-responsive"},Tt={class:"table"},Ft=e("thead",{class:"bg-light"},[e("tr",null,[e("th",{scope:"col",class:"ps-4 py-3 text-muted border-0"}," \u540D\u7A31 "),e("th",{scope:"col",class:"py-3 text-muted border-0"},"\u4FE1\u7BB1"),e("th",{scope:"col",class:"py-3 text-muted pe-3 border-0 text-end"}," \u64CD\u4F5C ")])],-1),Et={class:"text-nowrap"},St={scope:"row"},jt={class:"text-end"},At=["onClick"],Ot={class:"d-flex justify-content-end"},Rt={key:0,class:"overlay rounded-3 position-absolute d-flex align-items-center justify-content-center",style:{top:"0",bottom:"0",left:"0",right:"0"}},Nt={key:0,class:"spinner-border spinner-border-sm",role:"status"},Pt=e("span",{class:"visually-hidden"},"Loading...",-1),qt=[Pt],Qt={__name:"UserGroupDetail",setup(j){const{apiGetUserGroupId:B,apiGetTaskGroups:$,apiGetTasks:L,apiPutUserGroupId:f,apiGetUserGroupIdUsers:g,apiDeleteUserGroupIdUser:y,apiGetTraining:w}=de,h=le(),_=ye.useLoading(),n=o(0),C=o(""),m=o(""),b=o(!1),i=o(!1),c=o({}),V=async l=>{const t=_.show();try{const{group:a}=await B(l);c.value=a}catch(a){v("danger","\u53D6\u5F97\u8A73\u7D30\u8CC7\u8A0A\u5931\u6557",`${a.response.data.statusCode}:${a.response.data.message}`)}finally{t.hide()}};S(()=>{n.value=h.params.id,V(n.value)});const G=o([]),I=async l=>{const t=_.show();try{const{task_groups:a}=await $(l);G.value=a}catch(a){v("danger","\u53D6\u5F97\u5957\u7528\u7684\u4EFB\u52D9\u7FA4\u7D44\u5931\u6557",`${a.response.data.statusCode}:${a.response.data.message}`)}finally{t.hide()}},A=o([]),O=async l=>{const t=_.show();try{const{tasks:a}=await L(l);A.value=a}catch(a){v("danger","\u53D6\u5F97\u5957\u7528\u7684\u4EFB\u52D9\u5931\u6557",`${a.response.data.statusCode}:${a.response.data.message}`)}finally{t.hide()}},x=o([]),J=async l=>{const t=_.show();try{const{training_classes:a}=await w(l);x.value=a}catch(a){v("danger","\u53D6\u5F97\u5957\u7528\u7684\u4EFB\u52D9\u5931\u6557",`${a.response.data.statusCode}:${a.response.data.message}`)}finally{t.hide()}},ue=async l=>{const t=_.show();try{const a={name:c.value.name,enable:c.value.enable};await f(l,a),v("success","\u4FEE\u6539\u4F7F\u7528\u8005\u7FA4\u7D44\u6210\u529F","\u5DF2\u6210\u529F\u4FEE\u6539\u4F7F\u7528\u8005\u7FA4\u7D44"),V(n.value)}catch(a){v("danger","\u4FEE\u6539\u4F7F\u7528\u8005\u7FA4\u7D44\u5931\u6557",`${a.response.data.statusCode}:${a.response.data.message}`)}finally{t.hide()}},ee=o({}),pe=l=>{l==="add"&&(ee.value={}),m.value.show()},te=o(null);S(()=>{m.value=new ie(te.value.createUsersModalRef.hModal)});const me=()=>{b.value=!0,i.value=!0},se=o({}),R=o(""),W=o("email"),N=o({current_page:1,total:0}),T=async({groupId:l,filter:t,value:a,page:P,count:q})=>{const Y=_.show();try{const{users:s,pagination:z}=await g({groupId:l,filter:t,value:a,page:P,count:q});se.value=s,N.value=z,me()}catch(s){v("danger","\u53D6\u5F97\u5B78\u751F\u540D\u55AE\u5931\u6557",`${s.response.data.statusCode}:${s.response.data.message}`)}finally{Y.hide()}},be=l=>{l.type==="\u6210\u529F"?(v("success","\u532F\u5165\u4F7F\u7528\u8005\u6210\u529F"),T({groupId:n.value})):v("danger","\u532F\u5165\u4F7F\u7528\u8005\u5931\u6557",l.error)},X=o(null),ae=o({}),ve=({userId:l,type:t,name:a})=>{X.value.openModal(),ae.value={userId:l,type:t,name:a}},_e=async({userId:l,type:t})=>{try{t==="deleteUserGroupIdUser"&&(await y(n.value,l),await T({groupId:n.value})),v("success","\u5371\u96AA\u64CD\u4F5C\u6210\u529F\uFF0C\u4F7F\u7528\u8005\u5DF2\u7D93\u88AB\u522A\u9664\u3002")}catch(a){v("danger","\u5371\u96AA\u64CD\u4F5C\u5931\u6557\uFF0C\u8ACB\u91CD\u65B0\u64CD\u4F5C",a)}finally{X.value.hideModal()}};return S(()=>{C.value=document.querySelectorAll("#myTab button"),C.value.forEach(l=>{const t=new Ue(l);l.addEventListener("click",a=>{a.preventDefault(),t.show()})})}),(l,t)=>{const a=U("router-link"),P=U("Field"),q=U("ErrorMessage"),Y=U("VForm");return r(),d("div",null,[e("div",Se,[e("header",je,[e("nav",Ae,[e("ol",Oe,[e("li",Re,[u(a,{to:"/admin/users/groups"},{default:k(()=>[K(" \u4F7F\u7528\u8005\u7FA4\u7D44 ")]),_:1})]),Ne])]),e("div",Pe,[qe,e("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=s=>pe("add"))}," \u532F\u5165\u4F7F\u7528\u8005 ")])]),e("div",ze,[e("div",Ke,[u(Y,{ref:"refs",class:"h-100"},{default:k(({errors:s,meta:z})=>[e("div",Qe,[He,e("div",Je,[e("div",We,[Xe,u(P,{id:"name",modelValue:c.value.name,"onUpdate:modelValue":t[1]||(t[1]=D=>c.value.name=D),name:"name",label:"\u540D\u7A31",type:"text",class:Z(["form-control",{"is-invalid":s.name}]),rules:"required"},null,8,["modelValue","class"]),u(q,{name:"name",class:"invalid-feedback"})]),e("div",Ye,[Ze,u(P,{id:"enName",modelValue:c.value.keyword,"onUpdate:modelValue":t[2]||(t[2]=D=>c.value.keyword=D),name:"keyword",label:"\u82F1\u6587\u540D\u7A31",type:"text",class:Z(["form-control",{"is-invalid":s.keyword}]),rules:{required:!0,regex:/^[0-9a-z_-]{1,50}$/},disabled:""},null,8,["modelValue","class"]),u(q,{name:"keyword",class:"invalid-feedback"})]),e("div",et,[H(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=D=>c.value.enable=D),id:"flexCheckChecked"},null,512),[[xe,c.value.enable]]),tt])]),e("div",st,[e("button",{type:"button",disabled:!z.valid,class:"btn btn-primary",onClick:t[4]||(t[4]=D=>ue(c.value.id))}," \u66F4\u65B0 ",8,at)])])]),_:1},512)]),e("div",ot,[e("div",lt,[e("div",nt,[rt,e("ul",dt,[e("li",it,[e("button",{class:"nav-link",onClick:t[5]||(t[5]=s=>I(n.value)),id:"pills-home-tab","data-bs-toggle":"pill","data-bs-target":"#pills-home",type:"button",role:"tab","aria-controls":"pills-home","aria-selected":"true"}," \u4EFB\u52D9\u7FA4\u7D44 ")]),e("li",ct,[e("button",{class:"nav-link",onClick:t[6]||(t[6]=s=>O(n.value)),id:"pills-profile-tab","data-bs-toggle":"pill","data-bs-target":"#pills-profile",type:"button",role:"tab","aria-controls":"pills-profile","aria-selected":"false"}," \u4EFB\u52D9 ")]),e("li",ut,[e("button",{class:"nav-link",id:"pills-contact-tab",onClick:t[7]||(t[7]=s=>J(n.value)),"data-bs-toggle":"pill","data-bs-target":"#pills-contact",type:"button",role:"tab","aria-controls":"pills-contact","aria-selected":"false"}," \u76F4\u64AD\u73ED ")])])]),e("div",pt,[e("div",mt,[e("div",bt,[(r(!0),d(F,null,E(G.value,s=>(r(),d("ul",{class:"list-unstyled",key:s.id},[e("li",vt,p(s.name),1)]))),128))]),e("div",_t,[(r(!0),d(F,null,E(A.value,s=>(r(),d("ul",{class:"list-unstyled",key:s.id},[e("li",null,p(s.name),1)]))),128))]),e("div",ht,[(r(!0),d(F,null,E(x.value,s=>(r(),d("ul",{class:"list-unstyled",key:s.id},[e("li",null,p(s.name),1)]))),128))])])])])])]),e("div",ft,[e("div",gt,[yt,e("form",kt,[e("div",wt,[xt,H(e("select",{id:"filter",class:"form-select form-select-sm","onUpdate:modelValue":t[8]||(t[8]=s=>W.value=s)},Ct,512),[[ke,W.value]])]),e("div",Vt,[e("div",Gt,[It,H(e("input",{id:"datatableSearch",type:"search",class:"form-control border-top-0 border-start-0 border-end-0 rounded-0","onUpdate:modelValue":t[9]||(t[9]=s=>R.value=s),placeholder:"\u641C\u5C0B\u540D\u7A31\u3001\u4FE1\u7BB1",onKeydown:t[10]||(t[10]=we(oe(s=>T({groupId:n.value,value:R.value,filter:W.value}),["prevent"]),["enter"]))},null,544),[[ce,R.value]])])])])]),e("div",Dt,[e("div",Bt,[e("div",Lt,[e("table",Tt,[Ft,e("tbody",Et,[(r(!0),d(F,null,E(se.value,s=>(r(),d("tr",{class:"align-middle",key:s.id},[e("td",St,p(s.nickname),1),e("td",null,p(s.email),1),e("td",jt,[u(a,{to:`/admin/users/${s.id}`,class:"text-link me-1",target:"_blank"},{default:k(()=>[K("\u67E5\u770B")]),_:2},1032,["to"]),e("a",{href:"#",class:"text-link text-danger",onClick:oe(z=>ve({userId:s.id,type:"deleteUserGroupIdUser",name:s.nickname}),["prevent"])},"\u522A\u9664",8,At)])]))),128))])])]),e("div",Ot,[u(M(Me),{modelValue:N.value.current_page,"onUpdate:modelValue":t[11]||(t[11]=s=>N.value.current_page=s),records:N.value.total,"per-page":100,options:{chunk:6},onPaginate:t[12]||(t[12]=s=>T({groupId:n.value,page:s}))},null,8,["modelValue","records"])]),i.value?Q("",!0):(r(),d("div",Rt,[b.value?Q("",!0):(r(),d("button",{key:0,type:"button",class:"btn btn-outline-dark bg-white text-dark",onClick:t[13]||(t[13]=s=>T({groupId:n.value,value:R.value}))},[K(" \u8B80\u53D6\u5B78\u54E1\u540D\u55AE "),b.value?(r(),d("div",Nt,qt)):Q("",!0)]))]))])])])]),u(Be,{ref_key:"createUsersModalComponentRef",ref:te,"temp-users":ee.value,onCreateUsersMethod:be},null,8,["temp-users"]),u(Ee,{ref_key:"dangerActionsModalRef",ref:X,body:ae.value,onDangerUserMethod:_e},null,8,["body"])])}}};export{Qt as default};
